<!DOCTYPE html>
<html lang="en" data-theme=""><head>
    <title> Celia García Márquez | Sistemas de ficheros avanzados. Btrfs. </title>

    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.80.0" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description" content="Sistemas de ficheros avanzados">
    
    <link rel="stylesheet"
          href="https://www.celiagm.es/css/style.min.93ab6bdd416e6acc85a43e3a7629dda51ac58cbb8d193f5e62dc5d448bc2b385.css"
          integrity="sha256-k6tr3UFuasyFpD46dindpRrFjLuNGT9eYtxdRIvCs4U="
          crossorigin="anonymous"
          type="text/css">
    
    <link rel="stylesheet"
        href="https://www.celiagm.es/css/markupHighlight.min.4ac4c94828876abc926f5563ef81e319b441b25cad2c96842d2b87fd204a0de6.css"
        integrity="sha256-SsTJSCiHarySb1Vj74HjGbRBslytLJaELSuH/SBKDeY="
        crossorigin="anonymous"
        type="text/css">
    
    <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" 
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" 
    crossorigin="anonymous" />

    
    <link rel="shortcut icon" href="https://www.celiagm.es/favicons/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="https://www.celiagm.es/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.celiagm.es/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://www.celiagm.es/favicons/favicon-16x16.png">

    <link rel="canonical" href="https://www.celiagm.es/post/sistemas_ficheros/">

    
    
    
    
    <script type="text/javascript"
            src="https://www.celiagm.es/js/anatole-header.min.d8599ee07b7d3f11bafbac30657ccc591e8d7fd36a9f580cd4c09e24e0e4a971.js"
            integrity="sha256-2Fme4Ht9PxG6&#43;6wwZXzMWR6Nf9Nqn1gM1MCeJODkqXE="
            crossorigin="anonymous"></script>


    
        
        
        <script type="text/javascript"
                src="https://www.celiagm.es/js/anatole-theme-switcher.min.e289e9ebb2a4e7a7f895859c8a2b0da2de1ec73f22cea58d8475aa0597023837.js"
                integrity="sha256-4onp67Kk56f4lYWciisNot4exz8izqWNhHWqBZcCODc="
                crossorigin="anonymous"></script>
    
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.celiagm.es/images/avatar_red.jpg"/>

<meta name="twitter:title" content="Sistemas de ficheros avanzados. Btrfs."/>
<meta name="twitter:description" content="Sistemas de ficheros avanzados"/>


    

</head>
<body><div class="sidebar animated fadeInDown ">
    <div class="logo-title">
        <div class="title">
            <img src="https://www.celiagm.es/images/avatar_red.jpg" alt="profile picture">
            <h3 title=""><a href="/">Un bit de información cada día</a></h3>
            <div class="description">
                <p>Blog sobre informática</p>
            </div>
        </div>
    </div>
    <ul class="social-links">
        
            <li>
                <a href="https://www.linkedin.com/in/cgmarquez/" rel="me" aria-label="Linkedin">
                    <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://github.com/CeliaGMqrz" rel="me" aria-label="GitHub">
                    <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="mailto:cg.marquez95@gmail.com" rel="me" aria-label="e-mail">
                    <i class="fas fa-envelope fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
    <div class="footer">
        <div class="by_farbox">&copy; Celia García Márquez  2020-2021 </div>
    </div>
</div>
<div class="main">
    <div class="page-top  animated fadeInDown ">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <ul class="nav" id="navMenu">
        
        
            
            <li><a 
                   href="/"
                        
                   title="">Inicio</a></li>
        
            
            <li><a 
                   href="/post/"
                        
                   title="">Posts</a></li>
        
            
            <li><a 
                   href="/about/"
                        
                   title="">Sobre mí</a></li>
        
        
        
            <li class="theme-switch-item">
                <a class="theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
</div>

    <div class="autopagerize_page_element">
        <div class="content">
    <div class="post  animated fadeInDown ">
        <div class="post-content">
            
            <img class="post-thumbnail" src="https://www.celiagm.es/images/btrfs/btrfs.png" alt="Thumbnail image">
            
            <div class="post-title">
                <h3>Sistemas de ficheros avanzados. Btrfs.</h3>
                
                    <div class="info">
                        <em class="fas fa-calendar-day"></em>
                        <span class="date"> Mon, May 3, 2021 
                                           </span>
                        <em class="fas fa-stopwatch"></em>
                        <span class="reading-time">14-minute read</span>
                    </div>
                
            </div>

            <h2 id="zfsbtrfs">ZFS/Btrfs</h2>
<p>Son sistemas de archivos de alto rendimiento.</p>
<p>En este post hablaremos sobre <strong>Btrfs</strong>, que es el que hemos elegido para la práctica.</p>
<p><strong>Btrfs</strong> lo desarrolló Oracle Corporation para GNU/Linux. Surge con el objetivo de sustituir el sistema de archivos ZFS linux. Actualmente se considera estable. A diferencia del sistema original tiene una serie de caracteristicas que lo aventaja.</p>
<p>Se trata de un sistema completo de almacenamiento que no requiere otras herramientas pero podemos instalar <em>btrfs-progs</em> que es una herramienta adicional. Btrfs viene nativa en el kernel linux actualmente.</p>
<p>Btrfs tiene como caracteristicas similares a las de ZFS.</p>
<p>Caracteristicas avanzadas de ZFS:</p>
<ul>
<li>Consta de Copy on Write (CoW). Este sistema hace que al copiar un fichero, la copia no es más que una referencia o puntero del original(no cambian los rangos en los bloques a no ser que se modifique la copia).</li>
<li>Permite la deduplicación.</li>
<li>Cifrado propio.</li>
<li>Permite la compresión. Almacena los ficheros comprimidos para optimizar el uso del espacio.</li>
<li>Gestión de volúmenes. Permite gestionar volúmenes de forma independiente.</li>
<li>Permite hacer snapshots de forma nativa.</li>
<li>Tiene redundancia (RAID) sin necesidad de utilizar otro software como mdadm.</li>
</ul>
<p>Como hemos dicho anteriormente, Btrfs prácticamente tiene las mismas caracteristicas excluyendo el <em>cifrado propio</em>.</p>
<h2 id="entorno-de-trabajo-escenario">Entorno de trabajo: Escenario.</h2>
<h3 id="crea-un-escenario-que-incluya-una-máquina-y-varios-discos-asociados-a-ella">Crea un escenario que incluya una máquina y varios discos asociados a ella.</h3>
<p>Vamos a crear una mv en Vagrant con Virtualbox, que contendrá 5 discos y el SO será Debian Buster.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">disk</span> <span class="o">=</span> <span class="s1">&#39;./tmp/hdd21.vdi&#39;</span>
<span class="nv">disk2</span> <span class="o">=</span> <span class="s1">&#39;./tmp/hdd22.vdi&#39;</span>
<span class="nv">disk3</span> <span class="o">=</span> <span class="s1">&#39;./tmp/hdd23.vdi&#39;</span>
<span class="nv">disk4</span> <span class="o">=</span> <span class="s1">&#39;./tmp/hdd24.vdi&#39;</span>
<span class="nv">disk5</span> <span class="o">=</span> <span class="s1">&#39;./tmp/hdd25.vdi&#39;</span>

Vagrant.configure<span class="o">(</span><span class="s2">&#34;2&#34;</span><span class="o">)</span> <span class="k">do</span> <span class="p">|</span>config<span class="p">|</span>
  config.vm.box <span class="o">=</span> <span class="s2">&#34;debian/buster64&#34;</span>
  config.vm.hostname <span class="o">=</span> <span class="s2">&#34;btrfs2&#34;</span>
  config.vm.provider <span class="s2">&#34;virtualbox&#34;</span> <span class="k">do</span> <span class="p">|</span>vb<span class="p">|</span>
     vb.memory <span class="o">=</span> <span class="s2">&#34;1024&#34;</span>
     vb.cpus <span class="o">=</span> <span class="m">1</span>

     <span class="c1">#Añadir discos</span>
     <span class="k">if</span> not File.exist?<span class="o">(</span>disk<span class="o">)</span>
       vb.customize <span class="o">[</span><span class="s1">&#39;createhd&#39;</span>, <span class="s1">&#39;--filename&#39;</span>, disk, <span class="s1">&#39;--size&#39;</span>, <span class="m">1</span> * 1024<span class="o">]</span>
     end
     vb.customize <span class="o">[</span><span class="s1">&#39;storageattach&#39;</span>, :id,  <span class="s1">&#39;--storagectl&#39;</span>, <span class="s1">&#39;SATA Controller&#39;</span>, <span class="s1">&#39;--port&#39;</span>, 1, <span class="s1">&#39;--device&#39;</span>, 0, <span class="s1">&#39;--type&#39;</span>, <span class="s1">&#39;hdd&#39;</span>, <span class="s1">&#39;--medium&#39;</span>, disk<span class="o">]</span>
     <span class="k">if</span> not File.exist?<span class="o">(</span>disk<span class="o">)</span>
       vb.customize <span class="o">[</span><span class="s1">&#39;createhd&#39;</span>, <span class="s1">&#39;--filename&#39;</span>, disk2, <span class="s1">&#39;--size&#39;</span>, <span class="m">1</span> * 1024<span class="o">]</span>
     end
     vb.customize <span class="o">[</span><span class="s1">&#39;storageattach&#39;</span>, :id,  <span class="s1">&#39;--storagectl&#39;</span>, <span class="s1">&#39;SATA Controller&#39;</span>, <span class="s1">&#39;--port&#39;</span>, 2, <span class="s1">&#39;--device&#39;</span>, 0, <span class="s1">&#39;--type&#39;</span>, <span class="s1">&#39;hdd&#39;</span>, <span class="s1">&#39;--medium&#39;</span>, disk2<span class="o">]</span>
     <span class="k">if</span> not File.exist?<span class="o">(</span>disk<span class="o">)</span>
       vb.customize <span class="o">[</span><span class="s1">&#39;createhd&#39;</span>, <span class="s1">&#39;--filename&#39;</span>, disk3, <span class="s1">&#39;--size&#39;</span>, <span class="m">1</span> * 1024<span class="o">]</span>
     end
     vb.customize <span class="o">[</span><span class="s1">&#39;storageattach&#39;</span>, :id,  <span class="s1">&#39;--storagectl&#39;</span>, <span class="s1">&#39;SATA Controller&#39;</span>, <span class="s1">&#39;--port&#39;</span>, 3, <span class="s1">&#39;--device&#39;</span>, 0, <span class="s1">&#39;--type&#39;</span>, <span class="s1">&#39;hdd&#39;</span>, <span class="s1">&#39;--medium&#39;</span>, disk3<span class="o">]</span>
     <span class="k">if</span> not File.exist?<span class="o">(</span>disk<span class="o">)</span>
       vb.customize <span class="o">[</span><span class="s1">&#39;createhd&#39;</span>, <span class="s1">&#39;--filename&#39;</span>, disk4, <span class="s1">&#39;--size&#39;</span>, <span class="m">1</span> * 1024<span class="o">]</span>
     end
     vb.customize <span class="o">[</span><span class="s1">&#39;storageattach&#39;</span>, :id,  <span class="s1">&#39;--storagectl&#39;</span>, <span class="s1">&#39;SATA Controller&#39;</span>, <span class="s1">&#39;--port&#39;</span>, 4, <span class="s1">&#39;--device&#39;</span>, 0, <span class="s1">&#39;--type&#39;</span>, <span class="s1">&#39;hdd&#39;</span>, <span class="s1">&#39;--medium&#39;</span>, disk4<span class="o">]</span>
     <span class="k">if</span> not File.exist?<span class="o">(</span>disk<span class="o">)</span>
       vb.customize <span class="o">[</span><span class="s1">&#39;createhd&#39;</span>, <span class="s1">&#39;--filename&#39;</span>, disk5, <span class="s1">&#39;--size&#39;</span>, <span class="m">1</span> * 1024<span class="o">]</span>
     end
     vb.customize <span class="o">[</span><span class="s1">&#39;storageattach&#39;</span>, :id,  <span class="s1">&#39;--storagectl&#39;</span>, <span class="s1">&#39;SATA Controller&#39;</span>, <span class="s1">&#39;--port&#39;</span>, 5, <span class="s1">&#39;--device&#39;</span>, 0, <span class="s1">&#39;--type&#39;</span>, <span class="s1">&#39;hdd&#39;</span>, <span class="s1">&#39;--medium&#39;</span>, disk5<span class="o">]</span>
  end
end

</code></pre></div><p>Una vez dentro de la mv vamos a ejecutar &lsquo;<em>lsblk</em>&rsquo; para ver que los discos están disponibles.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~$ lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    <span class="m">0</span> 19.8G  <span class="m">0</span> disk
├─sda1   8:1    <span class="m">0</span> 18.8G  <span class="m">0</span> part /
├─sda2   8:2    <span class="m">0</span>    1K  <span class="m">0</span> part
└─sda5   8:5    <span class="m">0</span> 1021M  <span class="m">0</span> part <span class="o">[</span>SWAP<span class="o">]</span>
sdb      8:16   <span class="m">0</span>    1G  <span class="m">0</span> disk
sdc      8:32   <span class="m">0</span>    1G  <span class="m">0</span> disk
sdd      8:48   <span class="m">0</span>    1G  <span class="m">0</span> disk
sde      8:64   <span class="m">0</span>    1G  <span class="m">0</span> disk
sdf      8:80   <span class="m">0</span>    1G  <span class="m">0</span> disk

</code></pre></div><h3 id="instala-si-es-necesario-el-software-de-zfsbtrfs">Instala si es necesario el software de ZFS/Btrfs.</h3>
<p>Instalamos el software necesario si no viene incluido de la siguiente forma.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo apt install btrfs-tools
</code></pre></div><h3 id="gestiona-los-discos-adicionales-con-zfsbtrfs">Gestiona los discos adicionales con ZFS/Btrfs.</h3>
<p>En esta practica vamos a montar un Raid 5 con los tres primeros discos y dejaremos los dos últimos para sustituirlos en caso de fallo de alguno de ellos.</p>
<p><strong>¡!</strong></p>
<p>Todos los discos son de 1 GB pero podríamos tener discos de diferente tamaño para comprobar que al montar el RAID aprobecha todo el espacio posible y no pone un máximo o una quota como lo hace mdadm de la forma tradicional. En este caso como todos son de 1Gb no se verá esta característica, pero es importante mencionarla.</p>
<h4 id="formatear-sdb-a-btrfs">Formatear sdb a btrfs</h4>
<p>Vamos a crear un sistema de ficheros btrfs sobre sdb</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">mkfs.btrfs /dev/sdb
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@btrfs2:/home/vagrant# mkfs.btrfs /dev/sdb
btrfs-progs v4.20.1
See http://btrfs.wiki.kernel.org <span class="k">for</span> more information.

Label:              <span class="o">(</span>null<span class="o">)</span>
UUID:               0f50eb6d-5c33-4633-b2d7-a2dbcaac8d9b
Node size:          <span class="m">16384</span>
Sector size:        <span class="m">4096</span>
Filesystem size:    1.00GiB
Block group profiles:
  Data:             single            8.00MiB
  Metadata:         DUP              51.19MiB
  System:           DUP               8.00MiB
SSD detected:       no
Incompat features:  extref, skinny-metadata
Number of devices:  <span class="m">1</span>
Devices:
   ID        SIZE  PATH
    <span class="m">1</span>     1.00GiB  /dev/sdb

</code></pre></div><p>Comprobamos que se ha definido correctamente</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@btrfs2:/home/vagrant# lsblk -f
NAME   FSTYPE LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda
├─sda1 ext4         983742b1-65a8-49d1-a148-a3865ea09e24   16.1G     7% /
├─sda2
└─sda5 swap         04559374-06db-46f1-aa31-e7a4e6ec3286                <span class="o">[</span>SWAP<span class="o">]</span>
sdb    btrfs        0f50eb6d-5c33-4633-b2d7-a2dbcaac8d9b
sdc
sdd
sde
sdf
</code></pre></div><h3 id="soporte-en-dos-dispositivos-pool-de-almacenamiento">Soporte en dos dispositivos (pool de almacenamiento)</h3>
<p>Extenderemos el almacenamiento al disco sdc y comprobamos que funciona correctamente montandolo en un directorio.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@btrfs2:/home/vagrant# sudo mkfs.btrfs -f /dev/sdb /dev/sdc
btrfs-progs v4.20.1
See http://btrfs.wiki.kernel.org <span class="k">for</span> more information.

Label:              <span class="o">(</span>null<span class="o">)</span>
UUID:               86b2529f-b1a8-4937-8bbc-71666a87c24b
Node size:          <span class="m">16384</span>
Sector size:        <span class="m">4096</span>
Filesystem size:    2.00GiB
Block group profiles:
  Data:             RAID0           204.75MiB
  Metadata:         RAID1           102.38MiB
  System:           RAID1             8.00MiB
SSD detected:       no
Incompat features:  extref, skinny-metadata
Number of devices:  <span class="m">2</span>
Devices:
   ID        SIZE  PATH
    <span class="m">1</span>     1.00GiB  /dev/sdb
    <span class="m">2</span>     1.00GiB  /dev/sdc

</code></pre></div><p>Vemos que se ha montado correctamente y que el UUID es el mismo. Lo interpreta como RAID0 /RAID1. Une los dos discos como si fueran uno.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@btrfs2:/home/vagrant# mkdir /btrfs
root@btrfs2:/home/vagrant# mount /dev/sdb /btrfs/
root@btrfs2:/home/vagrant# lsblk -f
NAME   FSTYPE LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda
├─sda1 ext4         983742b1-65a8-49d1-a148-a3865ea09e24   16.1G     7% /
├─sda2
└─sda5 swap         04559374-06db-46f1-aa31-e7a4e6ec3286                <span class="o">[</span>SWAP<span class="o">]</span>
sdb    btrfs        86b2529f-b1a8-4937-8bbc-71666a87c24b    1.8G     1% /btrfs
sdc    btrfs        86b2529f-b1a8-4937-8bbc-71666a87c24b
sdd
sde
sdf
</code></pre></div><p>Ahora vamos a desmontarlo y crearemos el raid 5 en los tres primeros discos.</p>
<h3 id="configura-los-discos-en-raid-haciendo-pruebas-de-fallo-de-algún-disco-y-sustitución-restauración-del-raid-comenta-ventajas-e-inconvenientes-respecto-al-uso-de-raid-software-con-mdadm">Configura los discos en RAID, haciendo pruebas de fallo de algún disco y sustitución, restauración del RAID. Comenta ventajas e inconvenientes respecto al uso de RAID software con mdadm.</h3>
<p>Creamos raid5 con btrfs, le indicaremos que es un RAID5 de la siguiente forma.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@btrfs2:/home/vagrant# mkfs.btrfs -d raid5 -m raid5 -f /dev/sdb /dev/sdc /dev/sdd
btrfs-progs v4.20.1
See http://btrfs.wiki.kernel.org <span class="k">for</span> more information.

Label:              <span class="o">(</span>null<span class="o">)</span>
UUID:               76597d6f-6564-4468-9f6d-2d4f1de13a39
Node size:          <span class="m">16384</span>
Sector size:        <span class="m">4096</span>
Filesystem size:    3.00GiB
Block group profiles:
  Data:             RAID5           204.75MiB
  Metadata:         RAID5           204.75MiB
  System:           RAID5            16.00MiB
SSD detected:       no
Incompat features:  extref, raid56, skinny-metadata
Number of devices:  <span class="m">3</span>
Devices:
   ID        SIZE  PATH
    <span class="m">1</span>     1.00GiB  /dev/sdb
    <span class="m">2</span>     1.00GiB  /dev/sdc
    <span class="m">3</span>     1.00GiB  /dev/sdd

</code></pre></div><p>Vemos los dispositivos de bloques en el que el uuid es el mismo y pertenece a los tres discos.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@btrfs2:/home/vagrant# btrfs filesystem show
Label: none  uuid: 76597d6f-6564-4468-9f6d-2d4f1de13a39
	Total devices <span class="m">3</span> FS bytes used 128.00KiB
	devid    <span class="m">1</span> size 1.00GiB used 212.75MiB path /dev/sdb
	devid    <span class="m">2</span> size 1.00GiB used 212.75MiB path /dev/sdc
	devid    <span class="m">3</span> size 1.00GiB used 212.75MiB path /dev/sdd

</code></pre></div><p>Montamos uno de los discos del raid y comprobamos su capacidad.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@btrfs2:/home/vagrant# mount /dev/sdb /btrfs/
root@btrfs2:/home/vagrant# df -h
Filesystem      Size  Used Avail Use% Mounted on
udev            480M     <span class="m">0</span>  480M   0% /dev
tmpfs            99M  2.9M   96M   3% /run
/dev/sda1        19G  1.4G   17G   8% /
tmpfs           494M     <span class="m">0</span>  494M   0% /dev/shm
tmpfs           5.0M     <span class="m">0</span>  5.0M   0% /run/lock
tmpfs           494M     <span class="m">0</span>  494M   0% /sys/fs/cgroup
tmpfs            99M     <span class="m">0</span>   99M   0% /run/user/1000
/dev/sdb        3.0G   17M  2.6G   1% /btrfs

</code></pre></div><p>Como se puede apreciar tiene un total de 3GB , la suma de los tres discos.</p>
<p>Debemos saber que hay una utilidad, SCRUB de btrfs, que se utiliza pra limpiar el sistema de archivos btrfs. Lee los dispositivos de bloque y verifica las sumas de su comprobación, en otras palabras comprueba que no hay errores, y repara los bloques dañados si hay una copia correcta disponible.</p>
<p>De la siguiente forma comprobamos que todo está correcto.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@btrfs2:/home/vagrant# btrfs scrub start /dev/sdb
scrub started on /dev/sdb, fsid 76597d6f-6564-4468-9f6d-2d4f1de13a39 <span class="o">(</span><span class="nv">pid</span><span class="o">=</span>5086<span class="o">)</span>
root@btrfs2:/home/vagrant# btrfs scrub status /dev/sdb
scrub status <span class="k">for</span> 76597d6f-6564-4468-9f6d-2d4f1de13a39
	scrub started at Sat May  <span class="m">1</span> 18:21:39 <span class="m">2021</span> and finished after 00:00:00
	total bytes scrubbed: 0.00B with <span class="m">0</span> errors

</code></pre></div><p>En este ejemplo no vamos a provocar un fallo como tal pero suponemos que uno de los discos está dañado, entonces procedemos a añadir uno de los discos adicionales para sustituirlo.</p>
<p>Comprobaremos que el tamaño a 4 gb ya que tenemos los 4 discos.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@btrfs2:/home/vagrant# btrfs device add /dev/sde /btrfs
root@btrfs2:/home/vagrant# lsblk -f
NAME   FSTYPE LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda
├─sda1 ext4         983742b1-65a8-49d1-a148-a3865ea09e24   16.1G     7% /
├─sda2
└─sda5 swap         04559374-06db-46f1-aa31-e7a4e6ec3286                <span class="o">[</span>SWAP<span class="o">]</span>
sdb    btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39    3.1G     0% /btrfs
sdc    btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39
sdd    btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39
sde    btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39
sdf
root@btrfs2:/home/vagrant# df -h
Filesystem      Size  Used Avail Use% Mounted on
udev            480M     <span class="m">0</span>  480M   0% /dev
tmpfs            99M  2.9M   96M   3% /run
/dev/sda1        19G  1.4G   17G   8% /
tmpfs           494M     <span class="m">0</span>  494M   0% /dev/shm
tmpfs           5.0M     <span class="m">0</span>  5.0M   0% /run/lock
tmpfs           494M     <span class="m">0</span>  494M   0% /sys/fs/cgroup
tmpfs            99M     <span class="m">0</span>   99M   0% /run/user/1000
/dev/sdb        4.0G   17M  3.2G   1% /btrfs

</code></pre></div><p>Vemos los discos actuales.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@btrfs2:/home/vagrant# btrfs filesystem show
Label: none  uuid: 76597d6f-6564-4468-9f6d-2d4f1de13a39
	Total devices <span class="m">4</span> FS bytes used 256.00KiB
	devid    <span class="m">1</span> size 1.00GiB used 364.75MiB path /dev/sdb
	devid    <span class="m">2</span> size 1.00GiB used 364.75MiB path /dev/sdc
	devid    <span class="m">3</span> size 1.00GiB used 364.75MiB path /dev/sdd
	devid    <span class="m">4</span> size 1.00GiB used 0.00B path /dev/sde

</code></pre></div><p>Eliminamos el disco que tiene el fallo por ejemplo el <strong>sdc</strong> y comprobamos  que usa el nuevo disco <strong>sde</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@btrfs2:/home/vagrant# btrfs device delete /dev/sdc /btrfs/
root@btrfs2:/home/vagrant# btrfs filesystem show
Label: none  uuid: 76597d6f-6564-4468-9f6d-2d4f1de13a39
	Total devices <span class="m">3</span> FS bytes used 320.00KiB
	devid    <span class="m">1</span> size 1.00GiB used 320.00MiB path /dev/sdb
	devid    <span class="m">3</span> size 1.00GiB used 320.00MiB path /dev/sdd
	devid    <span class="m">4</span> size 1.00GiB used 320.00MiB path /dev/sde
</code></pre></div><p>Vemos que actualmente tenemos ocupados (sdb, sdd, sde)</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~$ lsblk -f
NAME FSTYPE LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda
├─sda1
│    ext4         983742b1-65a8-49d1-a148-a3865ea09e24   16.1G     7% /
├─sda2
│
└─sda5
     swap         04559374-06db-46f1-aa31-e7a4e6ec3286                <span class="o">[</span>SWAP<span class="o">]</span>
sdb  btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39
sdc
sdd  btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39
sde  btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39
sdf
</code></pre></div><hr>
<h3 id="realiza-ejercicios-con-pruebas-de-funcionamiento-de-las-principales-funcionalidades-compresión-cow-deduplicación-cifrado-etc">Realiza ejercicios con pruebas de funcionamiento de las principales funcionalidades: compresión, cow, deduplicación, cifrado, etc.</h3>
<h2 id="compresion-al-vuelo">Compresion al vuelo</h2>
<p>Se trata de almacenar la información comprimida, de foma que hacer la lectura el sistema es capaz de descomprimirla en ese mismo momento. La compresión se realiza archivo por archivo. Hay tres algoritmos disponibles ZLIB, LZO y ZSTD. El método predeterminado utliza el algoritmo <strong>ZLIB</strong>.</p>
<p>Para ello vamos a utilzar el disco sdf, le damos formato y lo montamos en un directorio aparte.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo mkfs.btrfs /dev/sdf

</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~$ mkdir compresion
</code></pre></div><p>Ahora relizamos la compresión al vuelo</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo mount -o <span class="nv">compress</span><span class="o">=</span>zlib /dev/sdf compresion/
</code></pre></div><p>Vemos que se ha montado correctamente</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~$ lsblk -f
NAME   FSTYPE LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda
├─sda1 ext4         983742b1-65a8-49d1-a148-a3865ea09e24   16.1G     7% /
├─sda2
└─sda5 swap         04559374-06db-46f1-aa31-e7a4e6ec3286                <span class="o">[</span>SWAP<span class="o">]</span>
sdb    btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39
sdc
sdd    btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39
sde    btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39
sdf    btrfs        feef8097-1952-4633-ac08-04dd1eeee2f6  904.6M     2% /home/vagrant/compresion

</code></pre></div><p>Ahora vamos a introducir algunos ficheros para ver que puede almacenar más información ya que la comprime. Esto se demora unos minutos ya que está introduciendo datos hasta que se quede sin espacio.</p>
<p>El disco es de 1G por lo que introduciremos información con la utlidad dd.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~$ sudo dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>compresion/info
dd: writing to <span class="s1">&#39;compresion/info&#39;</span>: No space left on device
44332355+0 records in
44332354+0 records out
<span class="m">22698165248</span> bytes <span class="o">(</span><span class="m">23</span> GB, <span class="m">21</span> GiB<span class="o">)</span> copied, 152.189 s, <span class="m">149</span> MB/s

</code></pre></div><p>Comprobamos el tamaño de la información comprimida que ocupa en este caso 22G</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~/compresion$ ls -la
total <span class="m">22166200</span>
drwxr-xr-x <span class="m">1</span> root    root              <span class="m">8</span> May  <span class="m">3</span> 15:11 .
drwxr-xr-x <span class="m">4</span> vagrant vagrant        <span class="m">4096</span> May  <span class="m">3</span> 15:04 ..
-rw-r--r-- <span class="m">1</span> root    root    <span class="m">22698165248</span> May  <span class="m">3</span> 15:14 info
vagrant@btrfs2:~/compresion$ du -hs
22G	.
vagrant@btrfs2:~/compresion$ du
22166196	.
vagrant@btrfs2:~/compresion$ du -hs info
22G	info

</code></pre></div><p>Comprobamos que el disco sigue siendo de 1G</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~/compresion$ sudo btrfs filesystem show /home/vagrant/compresion
Label: none  uuid: feef8097-1952-4633-ac08-04dd1eeee2f6
	Total devices <span class="m">1</span> FS bytes used 709.50MiB
	devid    <span class="m">1</span> size 1.00GiB used 1023.00MiB path /dev/sdf

</code></pre></div><p>Como conclusión podemos entender que el espacio está mejor aprovechado ya que la compresion la realiza al momento de introducir la información.</p>
<h2 id="cow">Cow</h2>
<p><img src="/images/btrfs/cow.png" alt="cow.png"></p>
<p><strong>Btrfs</strong> utiliza <strong>Copy on Write</strong>. Esta técnica permite hacer copias a los ficheros pero de forma distinta. Consiste en tener los archivos aparentemente copiados pero estos son simplemente punteros hacia el original, no es un enlace tampoco, ya que al modificar una copia se crean dispositivos de bloques nuevos a partir de los ya creados. Pero los primeros dispositivos de bloques del fichero al hacer la &lsquo;copia&rsquo; son los mismos en cada fichero copiado al original.</p>
<p>Con todo esto quiero decir que al hacer la copia del fichero si no se modifica la copia, el espacio consumido no aumenta al copiar sino al modificar el fichero copiado. Lo comprobamos de la siguiente forma.</p>
<p>Usaremos el disco <em>sdf</em>, que hemos utlizado antes pero antes hemos borrado la información del ejercicio anterior.</p>
<p>Creamos el fichero de prueba</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~/compresion$ sudo nano prueba.txt
vagrant@btrfs2:~/compresion$ ls -l
total <span class="m">4</span>
-rw-r--r-- <span class="m">1</span> root root <span class="m">14</span> May  <span class="m">3</span> 15:43 prueba.txt

</code></pre></div><p>Vemos el espacio ocupado en el disco</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~/compresion$ df -h <span class="p">|</span> grep <span class="s1">&#39;sdf&#39;</span>
/dev/sdf        1.0G   17M  681M   3% /home/vagrant/compresion
</code></pre></div><p>Hacemos la copia con el parámetro &ndash;reflink</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~/compresion$ sudo cp --reflink<span class="o">=</span>always prueba.txt copia.txt

vagrant@btrfs2:~/compresion$ df -h <span class="p">|</span> grep <span class="s1">&#39;sdf&#39;</span>
/dev/sdf        1.0G   17M  681M   3% /home/vagrant/compresion

</code></pre></div><p>Comprobamos que no ha ocupado más espacio.</p>
<p>¿COMO VER LOS BLOQUES OCUPADOS?</p>
<p>Vemos que los dispositivos de bloques son los mismos</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~/compresion$ sudo btrfs filesystem df /home/vagrant/compresion 
Data, single: <span class="nv">total</span><span class="o">=</span>224.00MiB, <span class="nv">used</span><span class="o">=</span>128.00KiB
System, DUP: <span class="nv">total</span><span class="o">=</span>8.00MiB, <span class="nv">used</span><span class="o">=</span>16.00KiB
Metadata, DUP: <span class="nv">total</span><span class="o">=</span>163.19MiB, <span class="nv">used</span><span class="o">=</span>112.00KiB
GlobalReserve, single: <span class="nv">total</span><span class="o">=</span>16.00MiB, <span class="nv">used</span><span class="o">=</span>0.00B
vagrant@btrfs2:~/compresion$ sudo btrfs filesystem du /home/vagrant/compresion 
     Total   Exclusive  Set shared  Filename
     0.00B       0.00B           -  /home/vagrant/compresion/prueba.txt
     0.00B       0.00B           -  /home/vagrant/compresion/copia.txt
     0.00B       0.00B           -  /home/vagrant/compresion/copia2.txt
     0.00B       0.00B       0.00B  /home/vagrant/compresion
vagrant@btrfs2:~/compresion$ sudo btrfs filesystem usage /home/vagrant/compresion 
Overall:
    Device size:		   1.00GiB
    Device allocated:		 566.38MiB
    Device unallocated:		 457.62MiB
    Device missing:		     0.00B
    Used:			 384.00KiB
    Free <span class="o">(</span>estimated<span class="o">)</span>:		 681.50MiB	<span class="o">(</span>min: 452.69MiB<span class="o">)</span>
    Data ratio:			      1.00
    Metadata ratio:		      2.00
    Global reserve:		  16.00MiB	<span class="o">(</span>used: 0.00B<span class="o">)</span>

Data,single: Size:224.00MiB, Used:128.00KiB
   /dev/sdf	 224.00MiB

Metadata,DUP: Size:163.19MiB, Used:112.00KiB
   /dev/sdf	 326.38MiB

System,DUP: Size:8.00MiB, Used:16.00KiB
   /dev/sdf	  16.00MiB

Unallocated:

</code></pre></div><h2 id="redimension-de-discos">Redimension de discos</h2>
<p>Podemos aumentar o disminuir el tamaño del disco en caliente.</p>
<p>Lo podemos hacer con el disco sdf</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~$ sudo btrfs filesystem show /home/vagrant/compresion/
Label: none  uuid: feef8097-1952-4633-ac08-04dd1eeee2f6
	Total devices <span class="m">1</span> FS bytes used 68.54MiB
	devid    <span class="m">1</span> size 1.00GiB used 566.38MiB path /dev/sdf

</code></pre></div><p>Reducción:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~$ sudo btrfs filesystem resize -400m /home/vagrant/compresion/
Resize <span class="s1">&#39;/home/vagrant/compresion/&#39;</span> of <span class="s1">&#39;-400m&#39;</span>
vagrant@btrfs2:~$ sudo btrfs filesystem show /home/vagrant/compresion/
Label: none  uuid: feef8097-1952-4633-ac08-04dd1eeee2f6
	Total devices <span class="m">1</span> FS bytes used 68.54MiB
	devid    <span class="m">1</span> size 624.00MiB used 342.38MiB path /dev/sdf


</code></pre></div><p>Aumento:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~$ sudo btrfs filesystem resize +300m /home/vagrant/compresion/
Resize <span class="s1">&#39;/home/vagrant/compresion/&#39;</span> of <span class="s1">&#39;+300m&#39;</span>
vagrant@btrfs2:~$ sudo btrfs filesystem show /home/vagrant/compresion/
Label: none  uuid: feef8097-1952-4633-ac08-04dd1eeee2f6
	Total devices <span class="m">1</span> FS bytes used 68.47MiB
	devid    <span class="m">1</span> size 924.00MiB used 342.38MiB path /dev/sdf

</code></pre></div><h2 id="fragmentación">Fragmentación</h2>
<p><img src="/images/btrfs/defrag.png" alt="defrag.png"></p>
<p>Para hacer una Fragmentación ejecutamos lo siguiente</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~$ sudo btrfs filesystem defragment -r  /home/vagrant/compresion/
vagrant@btrfs2:~$ sudo btrfs filesystem show /home/vagrant/compresion/
Label: none  uuid: feef8097-1952-4633-ac08-04dd1eeee2f6
	Total devices <span class="m">1</span> FS bytes used 68.47MiB
	devid    <span class="m">1</span> size 924.00MiB used 342.38MiB path /dev/sdf

</code></pre></div><blockquote>
<p>El cifrado no lo soporta btrfs</p>
</blockquote>
<h2 id="snapshots-con-btrfs">Snapshots con Btrfs</h2>
<p>Un snapshots en este caso es una instantánea de un dispositivo de almacenamiento.</p>
<p>Una vez tenemos formateado el disco en btrfs. Usaremos el disco sdf.</p>
<p>Tenemos que crear subvolúmenes.</p>
<h3 id="creacion-de-subvolúmenes">Creacion de subvolúmenes</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># Creamos el directorio donde vamos a montar el disco </span>
vagrant@btrfs2:~$ mkdir puntodemontaje
<span class="c1"># Montamos el volumen</span>
vagrant@btrfs2:~$ sudo mount /dev/sdf /home/vagrant/puntodemontaje/
<span class="c1"># Comprobamos que se ha montado correctamente</span>
vagrant@btrfs2:~$ lsblk -f
NAME   FSTYPE LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda                                                                     
├─sda1 ext4         983742b1-65a8-49d1-a148-a3865ea09e24   15.2G    12% /
├─sda2                                                                  
└─sda5 swap         04559374-06db-46f1-aa31-e7a4e6ec3286                <span class="o">[</span>SWAP<span class="o">]</span>
sdb    btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39                
sdc                                                                     
sdd    btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39                
sde    btrfs        76597d6f-6564-4468-9f6d-2d4f1de13a39                
sdf    btrfs        feef8097-1952-4633-ac08-04dd1eeee2f6  736.4M     9% /home/vagrant/puntodemontaje

<span class="c1"># Creamos el subvolumen 1 y el subvolumen 2</span>
vagrant@btrfs2:~$ sudo btrfs subvolume create puntodemontaje/sub1
Create subvolume <span class="s1">&#39;puntodemontaje/sub1&#39;</span>
vagrant@btrfs2:~$ sudo btrfs subvolume create puntodemontaje/sub2
Create subvolume <span class="s1">&#39;puntodemontaje/sub2&#39;</span>

<span class="c1"># Introducimos dos ficheros en el sub1</span>

vagrant@btrfs2:~/puntodemontaje/sub1$ ls
fichero2.txt  fichero.txt

</code></pre></div><h3 id="creacion-de-instantánea">Creacion de instantánea</h3>
<p>Ahora vamos a crear la instantánea del subvolumen 1, se comporta independientemente del subvolumen original, por lo que puede hacer lo que quiera sin afectar el original.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># Creamos una instantánea del sub1 en el sub2 </span>

vagrant@btrfs2:~$ sudo btrfs subvolume snapshot puntodemontaje/sub1/ puntodemontaje/sub2/snap_sub1
Create a snapshot of <span class="s1">&#39;puntodemontaje/sub1/&#39;</span> in <span class="s1">&#39;puntodemontaje/sub2/snap_sub1&#39;</span>

<span class="c1"># Vemos que contiene los mismos ficheros que el sub1 </span>
vagrant@btrfs2:~$ ls -l puntodemontaje/sub2/snap_sub1/
total <span class="m">8</span>
-rw-r--r-- <span class="m">1</span> root root  <span class="m">5</span> May  <span class="m">4</span> 18:10 fichero2.txt
-rw-r--r-- <span class="m">1</span> root root <span class="m">13</span> May  <span class="m">4</span> 18:09 fichero.txt

</code></pre></div><p>Si ocurriese algo y se ha realizado la instantánea anteriormente primero desmontamos el subvolumen que está dañado y luego montamos la instantánea en su lugar. Podríamos utilizar /etc/fstab para montarlo automáticamente.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># En este caso eliminamos el fichero.txt del sub1 </span>
vagrant@btrfs2:~$ sudo rm puntodemontaje/sub1/fichero.txt 
vagrant@btrfs2:~$ ls puntodemontaje/sub1/
fichero2.txt

</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># listamos los subvolumentes y las instantaneas </span>

vagrant@btrfs2:~$ sudo btrfs subvolume list /home/vagrant/puntodemontaje

ID <span class="m">263</span> gen <span class="m">245</span> top level <span class="m">262</span> path sub1
ID <span class="m">264</span> gen <span class="m">246</span> top level <span class="m">262</span> path sub2
ID <span class="m">265</span> gen <span class="m">245</span> top level <span class="m">264</span> path sub2/snap_sub1

<span class="c1"># Si queremos volver al punto anterior en el subvolumen 1 ponemos predeterminado la instantanea </span>

vagrant@btrfs2:~$ sudo btrfs subvolume set-default <span class="m">265</span> /home/vagrant/puntodemontaje/sub1

<span class="c1"># Para que tenga que tenga efecto tenemos que desmontar y volver a montar el volumen </span>

vagrant@btrfs2:~$ sudo umount /home/vagrant/puntodemontaje 
vagrant@btrfs2:~$ sudo mount /dev/sdf /home/vagrant/puntodemontaje/

<span class="c1"># Comprobamos que se ha montado directamente desde la instantánea</span>

vagrant@btrfs2:~$ ls puntodemontaje/
fichero2.txt  fichero.txt


</code></pre></div><p>Si listamos los subvolumenes comprobamos que guarda todos y cada uno de ellos pudiendo recuperar el que más nos convenga</p>
<p>Aquí estuve haciendo otras pruebas en otro directorio como se p uede apreciar.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~$ sudo btrfs subvolume list /home/vagrant/puntodemontaje
ID <span class="m">258</span> gen <span class="m">231</span> top level <span class="m">5</span> path sub1
ID <span class="m">259</span> gen <span class="m">236</span> top level <span class="m">5</span> path sub2
ID <span class="m">260</span> gen <span class="m">231</span> top level <span class="m">258</span> path sub1/snapshot1
ID <span class="m">261</span> gen <span class="m">236</span> top level <span class="m">5</span> path sub3
ID <span class="m">262</span> gen <span class="m">242</span> top level <span class="m">261</span> path sub3/snapshot2
ID <span class="m">263</span> gen <span class="m">247</span> top level <span class="m">262</span> path sub3/snapshot2/sub1
ID <span class="m">264</span> gen <span class="m">246</span> top level <span class="m">262</span> path sub3/snapshot2/sub2
ID <span class="m">265</span> gen <span class="m">245</span> top level <span class="m">264</span> path sub3/snapshot2/sub2/snap_sub1

</code></pre></div><p>Si queremos recuperar los directorios solo tenemos que hacer el mismo procedimiento.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">vagrant@btrfs2:~$ sudo btrfs subvolume set-default <span class="m">262</span> /home/vagrant/puntodemontaje/

vagrant@btrfs2:~$ sudo umount /home/vagrant/puntodemontaje 
vagrant@btrfs2:~$ sudo mount /dev/sdf /home/vagrant/puntodemontaje/
vagrant@btrfs2:~$ ls puntodemontaje/
hola.txt  sub1  sub2

vagrant@btrfs2:~/puntodemontaje$ tree
.
├── hola.txt
├── sub1
│   └── fichero2.txt
└── sub2
    └── snap_sub1
        ├── fichero2.txt
        └── fichero.txt

<span class="m">3</span> directories, <span class="m">4</span> files

</code></pre></div><p>Fuentes</p>
<p><a href="https://www.oracle.com/technical-resources/articles/it-infrastructure/admin-advanced-btrfs.html">https://www.oracle.com/technical-resources/articles/it-infrastructure/admin-advanced-btrfs.html</a>
<a href="https://wiki.archlinux.org/title/btrfs#Copy-on-Write_(CoW)">https://wiki.archlinux.org/title/btrfs#Copy-on-Write_(CoW)</a></p>
</div>
        <div class="post-footer">
            <div class="info">
                
                <span class="separator"><a class="tag" href="/tags/btrfs/">Btrfs</a></span>

            </div>
        </div>

        
    </div>


        </div>
    </div>
</div>

<script type="text/javascript"
        src="https://www.celiagm.es/js/medium-zoom.min.92f21c856129f84aeb719459b3e6ac621a3032fd7b180a18c04e1d12083f8aba.js"
        integrity="sha256-kvIchWEp&#43;ErrcZRZs&#43;asYhowMv17GAoYwE4dEgg/iro="
        crossorigin="anonymous"></script></body>

</html>
