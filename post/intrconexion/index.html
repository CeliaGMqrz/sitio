<!DOCTYPE html>
<html lang="en" data-theme=""><head>
    <title> Celia García Márquez | Interconexión de Servidores de Bases de Datos </title>

    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.80.0" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description" content="Enlaces entre distintos servidores de bases de datos">
    
    <link rel="stylesheet"
          href="https://www.celiagm.es/css/style.min.93ab6bdd416e6acc85a43e3a7629dda51ac58cbb8d193f5e62dc5d448bc2b385.css"
          integrity="sha256-k6tr3UFuasyFpD46dindpRrFjLuNGT9eYtxdRIvCs4U="
          crossorigin="anonymous"
          type="text/css">
    
    <link rel="stylesheet"
        href="https://www.celiagm.es/css/markupHighlight.min.4ac4c94828876abc926f5563ef81e319b441b25cad2c96842d2b87fd204a0de6.css"
        integrity="sha256-SsTJSCiHarySb1Vj74HjGbRBslytLJaELSuH/SBKDeY="
        crossorigin="anonymous"
        type="text/css">
    
    <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" 
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" 
    crossorigin="anonymous" />

    
    <link rel="shortcut icon" href="https://www.celiagm.es/favicons/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="https://www.celiagm.es/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.celiagm.es/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://www.celiagm.es/favicons/favicon-16x16.png">

    <link rel="canonical" href="https://www.celiagm.es/post/intrconexion/">

    
    
    
    
    <script type="text/javascript"
            src="https://www.celiagm.es/js/anatole-header.min.d8599ee07b7d3f11bafbac30657ccc591e8d7fd36a9f580cd4c09e24e0e4a971.js"
            integrity="sha256-2Fme4Ht9PxG6&#43;6wwZXzMWR6Nf9Nqn1gM1MCeJODkqXE="
            crossorigin="anonymous"></script>


    
        
        
        <script type="text/javascript"
                src="https://www.celiagm.es/js/anatole-theme-switcher.min.e289e9ebb2a4e7a7f895859c8a2b0da2de1ec73f22cea58d8475aa0597023837.js"
                integrity="sha256-4onp67Kk56f4lYWciisNot4exz8izqWNhHWqBZcCODc="
                crossorigin="anonymous"></script>
    
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.celiagm.es/images/avatar_red.jpg"/>

<meta name="twitter:title" content="Interconexión de Servidores de Bases de Datos"/>
<meta name="twitter:description" content="Enlaces entre distintos servidores de bases de datos"/>


    

</head>
<body><div class="sidebar animated fadeInDown ">
    <div class="logo-title">
        <div class="title">
            <img src="https://www.celiagm.es/images/avatar_red.jpg" alt="profile picture">
            <h3 title=""><a href="/">Un bit de información cada día</a></h3>
            <div class="description">
                <p>Blog sobre informática</p>
            </div>
        </div>
    </div>
    <ul class="social-links">
        
            <li>
                <a href="https://www.linkedin.com/in/cgmarquez/" rel="me" aria-label="Linkedin">
                    <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://github.com/CeliaGMqrz" rel="me" aria-label="GitHub">
                    <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="mailto:cg.marquez95@gmail.com" rel="me" aria-label="e-mail">
                    <i class="fas fa-envelope fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
    <div class="footer">
        <div class="by_farbox">&copy; Celia García Márquez  2020-2021 </div>
    </div>
</div>
<div class="main">
    <div class="page-top  animated fadeInDown ">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <ul class="nav" id="navMenu">
        
        
            
            <li><a 
                   href="/"
                        
                   title="">Inicio</a></li>
        
            
            <li><a 
                   href="/post/"
                        
                   title="">Posts</a></li>
        
            
            <li><a 
                   href="/about/"
                        
                   title="">Sobre mí</a></li>
        
        
        
            <li class="theme-switch-item">
                <a class="theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
</div>

    <div class="autopagerize_page_element">
        <div class="content">
    <div class="post  animated fadeInDown ">
        <div class="post-content">
            
            <img class="post-thumbnail" src="https://www.celiagm.es/images/interconexiones/banner.png" alt="Thumbnail image">
            
            <div class="post-title">
                <h3>Interconexión de Servidores de Bases de Datos</h3>
                
                    <div class="info">
                        <em class="fas fa-calendar-day"></em>
                        <span class="date"> Tue, Apr 20, 2021 
                                           </span>
                        <em class="fas fa-stopwatch"></em>
                        <span class="reading-time">15-minute read</span>
                    </div>
                
            </div>

            <h2 id="descripción-de-la-tarea">Descripción de la tarea</h2>
<p>Las <strong>interconexiones de servidores de bases de datos</strong> son operaciones que pueden ser muy útiles en diferentes contextos. Básicamente, se trata de acceder a datos que no están almacenados en nuestra base de datos, pudiendo combinarlos con los que ya tenemos.</p>
<p>En esta práctica veremos varias formas de crear un enlace entre distintos servidores de bases de datos.</p>
<p>Se pide:</p>
<ul>
<li>
<p>Realizar un enlace entre dos servidores de bases de datos <strong>ORACLE</strong>, explicando la configuración necesaria en ambos extremos y demostrando su funcionamiento.</p>
</li>
<li>
<p>Realizar un enlace entre dos servidores de bases de datos <strong>Postgres</strong>, explicando la configuración necesaria en ambos extremos y demostrando su funcionamiento.</p>
</li>
<li>
<p>Realizar un enlace entre un servidor <strong>ORACLE</strong> y otro <strong>Postgres</strong> o MySQL empleando Heterogeneus Services, explicando la configuración necesaria en ambos extremos y demostrando su funcionamiento.</p>
</li>
</ul>
<h2 id="enlace-entre-bases-de-datos-postgresql---postgresql">Enlace entre bases de datos PostgreSQL - PostgreSQL.</h2>
<p>Primero tenemos que crear el entorno de trabajo, en este caso he usado dos máquinas virtuales con Debian Buster, sobre las que está instalado postgresql. Para ver el entorno de trabajo vaya este post <a href="https://www.celiagm.es/post/postgresql_debian/">Instalación de postgresql sobre Debian Buster</a></p>
<p>El <strong>objetivo</strong> de este post se trata de lo siguiente:</p>
<p>Teniendo en cuenta el entorno de trabajo ya creado, los datos de prueba para poblar la base de datos serán los mismos, pero introduciremos una tabla en un servidor y la otra tabla en otro servidor de manera que vamos a <strong>construir un enlace</strong> entre ambos. Así cuando hagamos una consulta desde un servidor haciendo referencia al otro podamos obtener información conjunta de los dos servidores.</p>
<h3 id="permitir-conexiones-remotas">Permitir conexiones remotas</h3>
<p>Vamos a permitir conexiones remotas en ambos servidores, seguimos los siguientes pasos para las dos máquinas.</p>
<p>Editamos el fichero de configuracion de postgresql.</p>
<blockquote>
<p>Según la versión de postgresql que hemos instalado el directorio dentro de postgres será diferente.</p>
</blockquote>
<p>Buscamos las siguientes directivas y las cambiamos así:</p>
<p><code>/etc/postgresql/11/main/postgresql.conf </code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># Esta directiva es para que escuche no solo desde local sino que puedan acceder desde todas las direcciones.</span>
<span class="nv">listen_addresses</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
</code></pre></div><p>Editamos también el siguiente fichero para indicar también que permita la conexión remota desde cualquier direción.</p>
<p><code>nano /etc/postgresql/11/main/pg_hba.conf </code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">host all all 0.0.0.0/0 md5
</code></pre></div><p>Ahora reiniciamos el servicio</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo systecmtl restart postgresql
</code></pre></div><h3 id="crear-la-base-de-datos-y-usuarios-de-prueba">Crear la base de datos y usuarios de prueba.</h3>
<p>Si has poblado la base de datos con el post de la instalación anterior, puedes borrar en la máquina una de las tablas, la de &lsquo;emple&rsquo; por ejemplo.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">drop table emple cascade
</code></pre></div><p>Ahora podemos continuar con la tarea.</p>
<h3 id="máquina-1">Máquina 1</h3>
<p>Accedemos a postgresql como usuario &lsquo;postgres&rsquo; y creamos el usuario, la base de datos y le damos permisos al usuario sobre esa misma base de datos:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">postgres</span><span class="o">=</span><span class="c1"># create user celia1 with password &#39;celia1&#39;;</span>
CREATE ROLE
<span class="nv">postgres</span><span class="o">=</span><span class="c1"># create database prueba1;</span>
CREATE DATABASE
<span class="nv">postgres</span><span class="o">=</span><span class="c1"># grant all privileges on database prueba1 to celia1;</span>
GRANT
<span class="nv">postgres</span><span class="o">=</span><span class="c1"># exit</span>

</code></pre></div><p>Ahora salimos y entramos como el usuario creado</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">psql -h localhost -U celia1 -W -d prueba1
</code></pre></div><p>Creamos la tabla departamento</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">create table departamento<span class="o">(</span>
dept_no integer,
dnombre varchar<span class="o">(</span>20<span class="o">)</span>,
loc varchar<span class="o">(</span>20<span class="o">)</span>,
primary key <span class="o">(</span>dept_no<span class="o">)</span>
<span class="o">)</span><span class="p">;</span>
</code></pre></div><ul>
<li>Le añadimos los registros</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">insert into departamento
values <span class="o">(</span><span class="s1">&#39;10&#39;</span>,<span class="s1">&#39;CONTABILIDAD&#39;</span>,<span class="s1">&#39;SEVILLA&#39;</span><span class="o">)</span><span class="p">;</span>
insert into departamento
values <span class="o">(</span><span class="s1">&#39;20&#39;</span>,<span class="s1">&#39;INVESTIGACION&#39;</span>,<span class="s1">&#39;MADRID&#39;</span><span class="o">)</span><span class="p">;</span>
insert into departamento
values <span class="o">(</span><span class="s1">&#39;30&#39;</span>,<span class="s1">&#39;VENTAS&#39;</span>,<span class="s1">&#39;BARCELONA&#39;</span><span class="o">)</span><span class="p">;</span>
insert into departamento
values <span class="o">(</span><span class="s1">&#39;40&#39;</span>,<span class="s1">&#39;PRODUCCION&#39;</span>,<span class="s1">&#39;BILBAO&#39;</span><span class="o">)</span><span class="p">;</span>
</code></pre></div><h2 id="máquina-2">Máquina 2</h2>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">postgres</span><span class="o">=</span><span class="c1"># create user celia2 with password &#39;celia2&#39;;</span>
CREATE ROLE
<span class="nv">postgres</span><span class="o">=</span><span class="c1"># create database prueba2;</span>
CREATE DATABASE
<span class="nv">postgres</span><span class="o">=</span><span class="c1"># grant all privileges on database prueba2 to celia2;</span>
GRANT
<span class="nv">postgres</span><span class="o">=</span><span class="c1"># exit</span>
postgres@postgres2:~$ 
</code></pre></div><ul>
<li>Creamos la tabla empleados. No le ponemos la opción de clave extanjera ya que ahora mismo no existe la tabla departamento en esta base de datos.</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">create table empleado<span class="o">(</span>
emp_no integer,
apellidos varchar<span class="o">(</span>20<span class="o">)</span>,
oficio varchar<span class="o">(</span>20<span class="o">)</span>,
dir integer,
fecha_alt date,
salario integer,
comision integer,
dept_no integer,
primary key <span class="o">(</span>emp_no<span class="o">)</span>
<span class="o">)</span><span class="p">;</span>
</code></pre></div><ul>
<li>Le añadimos los registros</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">insert into empleado <span class="o">(</span>emp_no, apellidos, oficio, dir, fecha_alt, salario, dept_no<span class="o">)</span>
values <span class="o">(</span><span class="s1">&#39;7369&#39;</span>,<span class="s1">&#39;SANCHEZ&#39;</span>,<span class="s1">&#39;EMPLEADO&#39;</span>,<span class="s1">&#39;7902&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;104000&#39;</span>,<span class="s1">&#39;20&#39;</span><span class="o">)</span><span class="p">;</span>
insert into empleado
values <span class="o">(</span><span class="s1">&#39;7499&#39;</span>,<span class="s1">&#39;ARROYO&#39;</span>,<span class="s1">&#39;VENDEDOR&#39;</span>,<span class="s1">&#39;7698&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;208000&#39;</span>,<span class="s1">&#39;39000&#39;</span>,<span class="s1">&#39;30&#39;</span><span class="o">)</span><span class="p">;</span>
insert into empleado
values <span class="o">(</span><span class="s1">&#39;7521&#39;</span>,<span class="s1">&#39;SALA&#39;</span>,<span class="s1">&#39;VENDEDOR&#39;</span>,<span class="s1">&#39;7698&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;162500&#39;</span>,<span class="s1">&#39;162500&#39;</span>,<span class="s1">&#39;30&#39;</span><span class="o">)</span><span class="p">;</span>
insert into empleado <span class="o">(</span>emp_no, apellidos, oficio, dir, fecha_alt, salario, dept_no<span class="o">)</span>
values <span class="o">(</span><span class="s1">&#39;7566&#39;</span>,<span class="s1">&#39;JIMENEZ&#39;</span>,<span class="s1">&#39;DIRECTOR&#39;</span>,<span class="s1">&#39;7839&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;386750&#39;</span>,<span class="s1">&#39;20&#39;</span><span class="o">)</span><span class="p">;</span>
insert into empleado
values <span class="o">(</span><span class="s1">&#39;7654&#39;</span>,<span class="s1">&#39;MARTIN&#39;</span>,<span class="s1">&#39;VENDEDOR&#39;</span>,<span class="s1">&#39;7698&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;162500&#39;</span>,<span class="s1">&#39;182000&#39;</span>,<span class="s1">&#39;30&#39;</span><span class="o">)</span><span class="p">;</span>
insert into empleado <span class="o">(</span>emp_no, apellidos, oficio, dir, fecha_alt, salario, dept_no<span class="o">)</span>
values <span class="o">(</span><span class="s1">&#39;7698&#39;</span>,<span class="s1">&#39;NEGRO&#39;</span>,<span class="s1">&#39;DIRECTOR&#39;</span>,<span class="s1">&#39;7839&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;370500&#39;</span>,<span class="s1">&#39;30&#39;</span><span class="o">)</span><span class="p">;</span>
insert into empleado <span class="o">(</span>emp_no, apellidos, oficio, dir, fecha_alt, salario, dept_no<span class="o">)</span>
values <span class="o">(</span><span class="s1">&#39;7788&#39;</span>,<span class="s1">&#39;GIL&#39;</span>,<span class="s1">&#39;ANALISTA&#39;</span>,<span class="s1">&#39;7566&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;390000&#39;</span>,<span class="s1">&#39;20&#39;</span><span class="o">)</span><span class="p">;</span>
insert into empleado <span class="o">(</span>emp_no, apellidos, oficio, fecha_alt, salario, dept_no<span class="o">)</span>
values <span class="o">(</span><span class="s1">&#39;7839&#39;</span>,<span class="s1">&#39;REY&#39;</span>,<span class="s1">&#39;PRESIDENTE&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;650000&#39;</span>,<span class="s1">&#39;10&#39;</span><span class="o">)</span><span class="p">;</span>
insert into empleado
values <span class="o">(</span><span class="s1">&#39;7844&#39;</span>,<span class="s1">&#39;TOVAR&#39;</span>,<span class="s1">&#39;VENDEDOR&#39;</span>,<span class="s1">&#39;7698&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;195000&#39;</span>,<span class="s1">&#39;0&#39;</span>,<span class="s1">&#39;30&#39;</span><span class="o">)</span><span class="p">;</span>
insert into empleado <span class="o">(</span>emp_no, apellidos, oficio, dir, fecha_alt, salario, dept_no<span class="o">)</span>
values <span class="o">(</span><span class="s1">&#39;7876&#39;</span>,<span class="s1">&#39;ALONSO&#39;</span>,<span class="s1">&#39;EMPLEADO&#39;</span>,<span class="s1">&#39;7788&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;143000&#39;</span>,<span class="s1">&#39;20&#39;</span><span class="o">)</span><span class="p">;</span>
insert into empleado <span class="o">(</span>emp_no, apellidos, oficio, dir, fecha_alt, salario, dept_no<span class="o">)</span>
values <span class="o">(</span><span class="s1">&#39;7900&#39;</span>,<span class="s1">&#39;JIMENO&#39;</span>,<span class="s1">&#39;EMPLEADO&#39;</span>,<span class="s1">&#39;7698&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;1235000&#39;</span>,<span class="s1">&#39;30&#39;</span><span class="o">)</span><span class="p">;</span>
insert into empleado <span class="o">(</span>emp_no, apellidos, oficio, dir, fecha_alt, salario, dept_no<span class="o">)</span>
values <span class="o">(</span><span class="s1">&#39;7902&#39;</span>,<span class="s1">&#39;FERNANDEZ&#39;</span>,<span class="s1">&#39;ANALISTA&#39;</span>,<span class="s1">&#39;7566&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;390000&#39;</span>,<span class="s1">&#39;20&#39;</span><span class="o">)</span><span class="p">;</span>
insert into empleado <span class="o">(</span>emp_no, apellidos, oficio, dir, fecha_alt, salario, dept_no<span class="o">)</span>
values <span class="o">(</span><span class="s1">&#39;7934&#39;</span>,<span class="s1">&#39;MUÑOZ&#39;</span>,<span class="s1">&#39;EMPLEADO&#39;</span>,<span class="s1">&#39;7782&#39;</span>,<span class="s1">&#39;1980-12-12&#39;</span>,<span class="s1">&#39;169000&#39;</span>,<span class="s1">&#39;10&#39;</span><span class="o">)</span><span class="p">;</span>
</code></pre></div><h3 id="crear-el-enlace-maquina1-maquina2">Crear el enlace maquina1-maquina2</h3>
<p>Creamos un enlace en la máquina1, para ello nos conectamos como &lsquo;postgres&rsquo;</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">postgres@postgres1:~$ psql -d prueba1
psql <span class="o">(</span>11.11 <span class="o">(</span>Debian 11.11-0+deb10u1<span class="o">))</span>
Type <span class="s2">&#34;help&#34;</span> <span class="k">for</span> help.

<span class="nv">prueba1</span><span class="o">=</span><span class="c1"># create extension dblink;</span>
CREATE EXTENSION
<span class="nv">prueba1</span><span class="o">=</span><span class="c1"># </span>

</code></pre></div><p>Nos conectamos como el usuario &lsquo;celia1&rsquo; a la base de datos.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">psql -h localhost -U celia1 -W -d prueba1
</code></pre></div><p>Creamos el enlace de esta forma</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="k">select</span> * from dblink<span class="o">(</span><span class="s1">&#39;dbname=prueba2 host=192.168.100.224 user=celia2password=celia2&#39;</span>, <span class="s1">&#39;select * from empleado&#39;</span><span class="o">)</span> as empleados <span class="o">(</span>emp_no integer, apellidosvarchar, oficio varchar, dir integer, fecha_alt date, salario integer, comisioninteger, dept_no integer<span class="o">)</span><span class="p">;</span>

</code></pre></div><p>Ahora comprobamos que efectivamente muestra la tabla empleado que está en el otro servidor.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">prueba1</span><span class="o">=</span>&gt; <span class="k">select</span> * from dblink<span class="o">(</span><span class="s1">&#39;dbname=prueba2 host=192.168.100.224 user=celia2 password=celia2&#39;</span>, <span class="s1">&#39;select * from empleado&#39;</span><span class="o">)</span> as empleados <span class="o">(</span>emp_no integer, apellidos varchar, oficio varchar, dir integer, fecha_alt date, salario integer, comision integer, dept_no integer<span class="o">)</span><span class="p">;</span>
 emp_no <span class="p">|</span> apellidos <span class="p">|</span>   oficio   <span class="p">|</span> dir  <span class="p">|</span> fecha_alt  <span class="p">|</span> salario <span class="p">|</span> comision <span class="p">|</span> dept_no 
--------+-----------+------------+------+------------+---------+----------+---------
   <span class="m">7369</span> <span class="p">|</span> SANCHEZ   <span class="p">|</span> EMPLEADO   <span class="p">|</span> <span class="m">7902</span> <span class="p">|</span> 1980-12-12 <span class="p">|</span>  <span class="m">104000</span> <span class="p">|</span>          <span class="p">|</span>      <span class="m">20</span>
   <span class="m">7499</span> <span class="p">|</span> ARROYO    <span class="p">|</span> VENDEDOR   <span class="p">|</span> <span class="m">7698</span> <span class="p">|</span> 1980-12-12 <span class="p">|</span>  <span class="m">208000</span> <span class="p">|</span>    <span class="m">39000</span> <span class="p">|</span>      <span class="m">30</span>
   <span class="m">7521</span> <span class="p">|</span> SALA      <span class="p">|</span> VENDEDOR   <span class="p">|</span> <span class="m">7698</span> <span class="p">|</span> 1980-12-12 <span class="p">|</span>  <span class="m">162500</span> <span class="p">|</span>   <span class="m">162500</span> <span class="p">|</span>      <span class="m">30</span>
   <span class="m">7566</span> <span class="p">|</span> JIMENEZ   <span class="p">|</span> DIRECTOR   <span class="p">|</span> <span class="m">7839</span> <span class="p">|</span> 1980-12-12 <span class="p">|</span>  <span class="m">386750</span> <span class="p">|</span>          <span class="p">|</span>      <span class="m">20</span>
   <span class="m">7654</span> <span class="p">|</span> MARTIN    <span class="p">|</span> VENDEDOR   <span class="p">|</span> <span class="m">7698</span> <span class="p">|</span> 1980-12-12 <span class="p">|</span>  <span class="m">162500</span> <span class="p">|</span>   <span class="m">182000</span> <span class="p">|</span>      <span class="m">30</span>
   <span class="m">7698</span> <span class="p">|</span> NEGRO     <span class="p">|</span> DIRECTOR   <span class="p">|</span> <span class="m">7839</span> <span class="p">|</span> 1980-12-12 <span class="p">|</span>  <span class="m">370500</span> <span class="p">|</span>          <span class="p">|</span>      <span class="m">30</span>
   <span class="m">7788</span> <span class="p">|</span> GIL       <span class="p">|</span> ANALISTA   <span class="p">|</span> <span class="m">7566</span> <span class="p">|</span> 1980-12-12 <span class="p">|</span>  <span class="m">390000</span> <span class="p">|</span>          <span class="p">|</span>      <span class="m">20</span>
   <span class="m">7839</span> <span class="p">|</span> REY       <span class="p">|</span> PRESIDENTE <span class="p">|</span>      <span class="p">|</span> 1980-12-12 <span class="p">|</span>  <span class="m">650000</span> <span class="p">|</span>          <span class="p">|</span>      <span class="m">10</span>
   <span class="m">7844</span> <span class="p">|</span> TOVAR     <span class="p">|</span> VENDEDOR   <span class="p">|</span> <span class="m">7698</span> <span class="p">|</span> 1980-12-12 <span class="p">|</span>  <span class="m">195000</span> <span class="p">|</span>        <span class="m">0</span> <span class="p">|</span>      <span class="m">30</span>
   <span class="m">7876</span> <span class="p">|</span> ALONSO    <span class="p">|</span> EMPLEADO   <span class="p">|</span> <span class="m">7788</span> <span class="p">|</span> 1980-12-12 <span class="p">|</span>  <span class="m">143000</span> <span class="p">|</span>          <span class="p">|</span>      <span class="m">20</span>
   <span class="m">7900</span> <span class="p">|</span> JIMENO    <span class="p">|</span> EMPLEADO   <span class="p">|</span> <span class="m">7698</span> <span class="p">|</span> 1980-12-12 <span class="p">|</span> <span class="m">1235000</span> <span class="p">|</span>          <span class="p">|</span>      <span class="m">30</span>
   <span class="m">7902</span> <span class="p">|</span> FERNANDEZ <span class="p">|</span> ANALISTA   <span class="p">|</span> <span class="m">7566</span> <span class="p">|</span> 1980-12-12 <span class="p">|</span>  <span class="m">390000</span> <span class="p">|</span>          <span class="p">|</span>      <span class="m">20</span>
   <span class="m">7934</span> <span class="p">|</span> MUÑOZ     <span class="p">|</span> EMPLEADO   <span class="p">|</span> <span class="m">7782</span> <span class="p">|</span> 1980-12-12 <span class="p">|</span>  <span class="m">169000</span> <span class="p">|</span>          <span class="p">|</span>      <span class="m">10</span>

</code></pre></div><h3 id="crear-el-enlace-maquina2-maquina1">Crear el enlace maquina2-maquina1</h3>
<p>Ejecutamos el mismo procedimiento que hemos ido haciendo en el primer enlace y comprobamos que muestra la tabla departamento del primer servidor</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">postgres@postgres2:~$ psql -d prueba2
psql <span class="o">(</span>11.11 <span class="o">(</span>Debian 11.11-1.pgdg100+1<span class="o">))</span>
Type <span class="s2">&#34;help&#34;</span> <span class="k">for</span> help.

<span class="nv">prueba2</span><span class="o">=</span><span class="c1"># create extension dblink;</span>
CREATE EXTENSION
<span class="nv">prueba2</span><span class="o">=</span><span class="c1"># quit</span>
postgres@postgres2:~$ psql -h localhost -U celia2 -W -d prueba2
Password: 
psql <span class="o">(</span>11.11 <span class="o">(</span>Debian 11.11-1.pgdg100+1<span class="o">))</span>
SSL connection <span class="o">(</span>protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off<span class="o">)</span>
Type <span class="s2">&#34;help&#34;</span> <span class="k">for</span> help.

<span class="nv">prueba2</span><span class="o">=</span>&gt; <span class="k">select</span> * from dblink<span class="o">(</span><span class="s1">&#39;dbname=prueba1 host=192.168.100.225 user=celia1 password=celia1&#39;</span>, <span class="s1">&#39;select * from departamento&#39;</span><span class="o">)</span> as departamento <span class="o">(</span>dept_no integer, dnombre varchar, loc varchar<span class="o">)</span><span class="p">;</span>
 dept_no <span class="p">|</span>    dnombre    <span class="p">|</span>    loc    
---------+---------------+-----------
      <span class="m">10</span> <span class="p">|</span> CONTABILIDAD  <span class="p">|</span> SEVILLA
      <span class="m">20</span> <span class="p">|</span> INVESTIGACION <span class="p">|</span> MADRID
      <span class="m">30</span> <span class="p">|</span> VENTAS        <span class="p">|</span> BARCELONA
      <span class="m">40</span> <span class="p">|</span> PRODUCCION    <span class="p">|</span> BILBAO
<span class="o">(</span><span class="m">4</span> rows<span class="o">)</span>
</code></pre></div><p>Como hemos visto se ha creado los enlaces correctamente y hemos podido hacer consultas a tablas externas.</p>
<h2 id="enlace-entre-bases-de-datos-oracle-y-postgresql">Enlace entre bases de datos ORACLE y Postgresql</h2>
<p>Vamos a crear un enlace desde Oracle ubicado en un CentOS8 a Postgresql ubicado en Debian Buster.</p>
<h3 id="configuracion-servidor-oracle-centos8">Configuracion Servidor Oracle (CentOS8)</h3>
<p>Necesitaremos instalar los siguientes paquetes:</p>
<ul>
<li>postgresql-odbc.x86_64 (Controlador oficial de postgres)</li>
<li>unixODBC (Administrador de controladores. Permite trabajar con SQL)</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">dnf install unixODBC-2.3.7-1.el8.i686
dnf install postgresql-odbc.x86_64 
</code></pre></div><p>Ahora vamos a la configuración.</p>
<p>Primero vamos a editar el fichero <code>/etc/odbcinst.ini</code>. En este fichero está la configuración para los controladores unixODBC. Es recomendable editarlo con la utilidad &lsquo;obdcinst&rsquo; pero en esta ocasión lo editaremos a mano y dejaremos el siguiente contenido.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">nano /etc/odbcinst.ini
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>PostgreSQL ANSI<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>PostgreSQL ODBC driver <span class="o">(</span>ANSI version<span class="o">)</span>
<span class="nv">Driver</span><span class="o">=</span>psqlodbca.so
<span class="nv">Setup</span><span class="o">=</span>libodbcpsqlS.so
<span class="nv">Debug</span><span class="o">=</span><span class="m">0</span>
<span class="nv">CommLog</span><span class="o">=</span><span class="m">1</span>
<span class="nv">UsageCount</span><span class="o">=</span><span class="m">1</span>

<span class="o">[</span>PostgreSQL Unicode<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>PostgreSQL ODBC driver <span class="o">(</span>Unicode version<span class="o">)</span>
<span class="nv">Driver</span><span class="o">=</span>psqlodbcw.so
<span class="nv">Setup</span><span class="o">=</span>libodbcpsqlS.so
<span class="nv">Debug</span><span class="o">=</span><span class="m">0</span>
<span class="nv">CommLog</span><span class="o">=</span><span class="m">1</span>
<span class="nv">UsageCount</span><span class="o">=</span><span class="m">1</span>
</code></pre></div><p>Ahora vamos a editar el fichero <code>/etc/odbc.ini</code>. El contenido de este fichero es más complicado porque según el controlador que vayamos a usar requiere entradas diferentes. En este caso introduciremos la entrada para Postgresql.</p>
<p>Tendremos que indicar la dirección del servidor postgres, el usuario, la contraseña y a la base de datos donde nos vamos a conectar.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">nano /etc/odbc.ini
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">
<span class="o">[</span>PSQLA<span class="o">]</span>
<span class="nv">Debug</span> <span class="o">=</span> <span class="m">0</span>
<span class="nv">CommLog</span> <span class="o">=</span> <span class="m">0</span>
<span class="nv">ReadOnly</span> <span class="o">=</span> <span class="m">1</span>
<span class="nv">Driver</span> <span class="o">=</span> PostgreSQL ANSI
<span class="nv">Servername</span> <span class="o">=</span> 192.168.100.67
<span class="nv">Username</span> <span class="o">=</span> celia
<span class="nv">Password</span> <span class="o">=</span> celia
<span class="nv">Port</span> <span class="o">=</span> <span class="m">5432</span>
<span class="nv">Database</span> <span class="o">=</span> prueba
<span class="nv">Trace</span> <span class="o">=</span> <span class="m">0</span>
<span class="nv">TraceFile</span> <span class="o">=</span> /tmp/sql.log

<span class="o">[</span>PSQLU<span class="o">]</span>
<span class="nv">Debug</span> <span class="o">=</span> <span class="m">0</span>
<span class="nv">CommLog</span> <span class="o">=</span> <span class="m">0</span>
<span class="nv">ReadOnly</span> <span class="o">=</span> <span class="m">0</span>
<span class="nv">Driver</span> <span class="o">=</span> PostgreSQL Unicode
<span class="nv">Servername</span> <span class="o">=</span> 192.168.100.67
<span class="nv">Username</span> <span class="o">=</span>  celia
<span class="nv">Password</span> <span class="o">=</span> celia
<span class="nv">Port</span> <span class="o">=</span> <span class="m">5432</span>
<span class="nv">Database</span> <span class="o">=</span> prueba
<span class="nv">Trace</span> <span class="o">=</span> <span class="m">0</span>
<span class="nv">TraceFile</span> <span class="o">=</span> /tmp/sql.log

<span class="o">[</span>Default<span class="o">]</span>
<span class="nv">Driver</span> <span class="o">=</span> /usr/lib64/liboplodbcS.so.2

</code></pre></div><p>Una vez se haya configurado podemos comprobar la sintaxis de la configuración con los siguientes comandos.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@bd ~<span class="o">]</span><span class="c1"># odbcinst -q -d</span>
<span class="o">[</span>PostgreSQL ANSI<span class="o">]</span>
<span class="o">[</span>PostgreSQL Unicode<span class="o">]</span>
<span class="o">[</span>MySQL<span class="o">]</span>
<span class="o">[</span>FreeTDS<span class="o">]</span>
<span class="o">[</span>MariaDB<span class="o">]</span>

<span class="o">[</span>root@bd ~<span class="o">]</span><span class="c1"># odbcinst -q -s</span>
<span class="o">[</span>PSQLA<span class="o">]</span>
<span class="o">[</span>PSQLU<span class="o">]</span>
<span class="o">[</span>Default<span class="o">]</span>

</code></pre></div><p>Ahora vamos a comprobar la conexión con la base de datos de postgres de esta forma</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@bd ~<span class="o">]</span><span class="c1"># isql -v PSQLU</span>
+---------------------------------------+
<span class="p">|</span> Connected!                            <span class="p">|</span>
<span class="p">|</span>                                       <span class="p">|</span>
<span class="p">|</span> sql-statement                         <span class="p">|</span>
<span class="p">|</span> <span class="nb">help</span> <span class="o">[</span>tablename<span class="o">]</span>                      <span class="p">|</span>
<span class="p">|</span> quit                                  <span class="p">|</span>
<span class="p">|</span>                                       <span class="p">|</span>
+---------------------------------------+
SQL&gt; <span class="k">select</span> * from departamento<span class="p">;</span>
+------------+---------------------+---------------------+
<span class="p">|</span> dept_no    <span class="p">|</span> dnombre             <span class="p">|</span> loc                 <span class="p">|</span>
+------------+---------------------+---------------------+
<span class="p">|</span> <span class="m">10</span>         <span class="p">|</span> CONTABILIDAD        <span class="p">|</span> SEVILLA             <span class="p">|</span>
<span class="p">|</span> <span class="m">20</span>         <span class="p">|</span> INVESTIGACION       <span class="p">|</span> MADRID              <span class="p">|</span>
<span class="p">|</span> <span class="m">30</span>         <span class="p">|</span> VENTAS              <span class="p">|</span> BARCELONA           <span class="p">|</span>
<span class="p">|</span> <span class="m">40</span>         <span class="p">|</span> PRODUCCION          <span class="p">|</span> BILBAO              <span class="p">|</span>
+------------+---------------------+---------------------+
SQLRowCount returns <span class="m">4</span>
<span class="m">4</span> rows fetched
SQL&gt; quit
<span class="o">[</span>root@bd ~<span class="o">]</span><span class="c1"># isql -v PSQLA</span>
+---------------------------------------+
<span class="p">|</span> Connected!                            <span class="p">|</span>
<span class="p">|</span>                                       <span class="p">|</span>
<span class="p">|</span> sql-statement                         <span class="p">|</span>
<span class="p">|</span> <span class="nb">help</span> <span class="o">[</span>tablename<span class="o">]</span>                      <span class="p">|</span>
<span class="p">|</span> quit                                  <span class="p">|</span>
<span class="p">|</span>                                       <span class="p">|</span>
+---------------------------------------+
SQL&gt; <span class="k">select</span> * from departamento<span class="p">;</span>
+------------+---------------------+---------------------+
<span class="p">|</span> dept_no    <span class="p">|</span> dnombre             <span class="p">|</span> loc                 <span class="p">|</span>
+------------+---------------------+---------------------+
<span class="p">|</span> <span class="m">10</span>         <span class="p">|</span> CONTABILIDAD        <span class="p">|</span> SEVILLA             <span class="p">|</span>
<span class="p">|</span> <span class="m">20</span>         <span class="p">|</span> INVESTIGACION       <span class="p">|</span> MADRID              <span class="p">|</span>
<span class="p">|</span> <span class="m">30</span>         <span class="p">|</span> VENTAS              <span class="p">|</span> BARCELONA           <span class="p">|</span>
<span class="p">|</span> <span class="m">40</span>         <span class="p">|</span> PRODUCCION          <span class="p">|</span> BILBAO              <span class="p">|</span>
+------------+---------------------+---------------------+
SQLRowCount returns <span class="m">4</span>
<span class="m">4</span> rows fetched

</code></pre></div><p>Como podemos comprobar ya podemos visualizar el contenido de la tabla departamento que tenemos en postgres.</p>
<p>Si todo ha ido bien hasta este punto, vamos a crear el fichero <code>initPSQLU.ora</code>. Este fichero nos permitirá crear el enlace con postgresql.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">nano /opt/oracle/product/19c/dbhome_1/hs/admin/initPSQLU.ora
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">HS_FDS_CONNECT_INFO</span> <span class="o">=</span> PSQLU
<span class="nv">HS_FDS_TRACE_LEVEL</span> <span class="o">=</span> Debug
<span class="nv">HS_FDS_SHAREABLE_NAME</span> <span class="o">=</span> /usr/lib64/psqlodbcw.so
<span class="nv">HS_LANGUAGE</span> <span class="o">=</span> AMERICAN_AMERICA.WE8ISO8859P1
<span class="nb">set</span> <span class="nv">ODBCINI</span><span class="o">=</span>/etc/odbc.ini
</code></pre></div><p>Ahora vamos a editar los ficheros <code>listener.ora</code> y <code>tsnames.ora</code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">nano /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora 
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># listener.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora</span>
<span class="c1"># Generated by Oracle configuration tools.</span>

<span class="nv">LISTENER</span> <span class="o">=</span>
  <span class="o">(</span><span class="nv">DESCRIPTION_LIST</span> <span class="o">=</span>
    <span class="o">(</span><span class="nv">DESCRIPTION</span> <span class="o">=</span>
      <span class="o">(</span><span class="nv">ADDRESS</span> <span class="o">=</span> <span class="o">(</span><span class="nv">PROTOCOL</span> <span class="o">=</span> TCP<span class="o">)(</span><span class="nv">HOST</span> <span class="o">=</span> bd.oracle.celia.es<span class="o">)(</span><span class="nv">PORT</span> <span class="o">=</span> 1521<span class="o">))</span>
      <span class="o">(</span><span class="nv">ADDRESS</span> <span class="o">=</span> <span class="o">(</span><span class="nv">PROTOCOL</span> <span class="o">=</span> IPC<span class="o">)(</span><span class="nv">KEY</span> <span class="o">=</span> EXTPROC1521<span class="o">))</span>
    <span class="o">)</span>
  <span class="o">)</span>

<span class="nv">SID_LIST_LISTENER</span><span class="o">=</span>
 <span class="o">(</span><span class="nv">SID_LIST</span><span class="o">=</span>
 <span class="o">(</span><span class="nv">SID_DESC</span><span class="o">=</span>
 <span class="o">(</span><span class="nv">SID_NAME</span><span class="o">=</span>PSQLU<span class="o">)</span>
 <span class="o">(</span><span class="nv">ORACLE_HOME</span><span class="o">=</span>/opt/oracle/product/19c/dbhome_1<span class="o">)</span>
 <span class="o">(</span><span class="nv">PROGRAM</span><span class="o">=</span>dg4odbc<span class="o">)</span>
 <span class="o">)</span>
 <span class="o">)</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">nano /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora 
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">
<span class="c1"># tnsnames.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora</span>
<span class="c1"># Generated by Oracle configuration tools.</span>

<span class="nv">ORCLCDB</span> <span class="o">=</span>
  <span class="o">(</span><span class="nv">DESCRIPTION</span> <span class="o">=</span>
    <span class="o">(</span><span class="nv">ADDRESS</span> <span class="o">=</span> <span class="o">(</span><span class="nv">PROTOCOL</span> <span class="o">=</span> TCP<span class="o">)(</span><span class="nv">HOST</span> <span class="o">=</span> localhost<span class="o">)(</span><span class="nv">PORT</span> <span class="o">=</span> 1521<span class="o">))</span>
    <span class="o">(</span><span class="nv">CONNECT_DATA</span> <span class="o">=</span>
      <span class="o">(</span><span class="nv">SERVER</span> <span class="o">=</span> DEDICATED<span class="o">)</span>
      <span class="o">(</span><span class="nv">SERVICE_NAME</span> <span class="o">=</span> ORCLCDB<span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>

<span class="nv">LISTENER_ORCLCDB</span> <span class="o">=</span>
  <span class="o">(</span><span class="nv">ADDRESS</span> <span class="o">=</span> <span class="o">(</span><span class="nv">PROTOCOL</span> <span class="o">=</span> TCP<span class="o">)(</span><span class="nv">HOST</span> <span class="o">=</span> localhost<span class="o">)(</span><span class="nv">PORT</span> <span class="o">=</span> 1521<span class="o">))</span>


<span class="nv">PSQLU</span> <span class="o">=</span>
 <span class="o">(</span><span class="nv">DESCRIPTION</span><span class="o">=</span>
 <span class="o">(</span><span class="nv">ADDRESS</span><span class="o">=(</span><span class="nv">PROTOCOL</span><span class="o">=</span>tcp<span class="o">)(</span><span class="nv">HOST</span><span class="o">=</span>localhost<span class="o">)(</span><span class="nv">PORT</span><span class="o">=</span>1521<span class="o">))</span>
 <span class="o">(</span><span class="nv">CONNECT_DATA</span><span class="o">=(</span><span class="nv">SID</span><span class="o">=</span>PSQLU<span class="o">))</span>
 <span class="o">(</span><span class="nv">HS</span><span class="o">=</span>OK<span class="o">)</span>
 <span class="o">)</span>


</code></pre></div><p>Una vez configurado todo, desde el ususario oracle paramos el listener y lo volvemos a iniciar.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">lsnrctl stop
lsnrctl start
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>oracle@bd ~<span class="o">]</span>$ lsnrctl stop

LSNRCTL <span class="k">for</span> Linux: Version 19.0.0.0.0 - Production on 20-APR-2021 13:59:43

Copyright <span class="o">(</span>c<span class="o">)</span> 1991, 2019, Oracle.  All rights reserved.

Connecting to <span class="o">(</span><span class="nv">DESCRIPTION</span><span class="o">=(</span><span class="nv">ADDRESS</span><span class="o">=(</span><span class="nv">PROTOCOL</span><span class="o">=</span>TCP<span class="o">)(</span><span class="nv">HOST</span><span class="o">=</span>bd.oracle.celia.es<span class="o">)(</span><span class="nv">PORT</span><span class="o">=</span>1521<span class="o">)))</span>
The <span class="nb">command</span> completed successfully
<span class="o">[</span>oracle@bd ~<span class="o">]</span>$ lsnrctl start

LSNRCTL <span class="k">for</span> Linux: Version 19.0.0.0.0 - Production on 20-APR-2021 13:59:48

Copyright <span class="o">(</span>c<span class="o">)</span> 1991, 2019, Oracle.  All rights reserved.

Starting /opt/oracle/product/19c/dbhome_1/bin/tnslsnr: please wait...

TNSLSNR <span class="k">for</span> Linux: Version 19.0.0.0.0 - Production
System parameter file is /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora
Log messages written to /opt/oracle/diag/tnslsnr/bd/listener/alert/log.xml
Listening on: <span class="o">(</span><span class="nv">DESCRIPTION</span><span class="o">=(</span><span class="nv">ADDRESS</span><span class="o">=(</span><span class="nv">PROTOCOL</span><span class="o">=</span>tcp<span class="o">)(</span><span class="nv">HOST</span><span class="o">=</span>bd.oracle.celia.es<span class="o">)(</span><span class="nv">PORT</span><span class="o">=</span>1521<span class="o">)))</span>
Listening on: <span class="o">(</span><span class="nv">DESCRIPTION</span><span class="o">=(</span><span class="nv">ADDRESS</span><span class="o">=(</span><span class="nv">PROTOCOL</span><span class="o">=</span>ipc<span class="o">)(</span><span class="nv">KEY</span><span class="o">=</span>EXTPROC1521<span class="o">)))</span>

Connecting to <span class="o">(</span><span class="nv">DESCRIPTION</span><span class="o">=(</span><span class="nv">ADDRESS</span><span class="o">=(</span><span class="nv">PROTOCOL</span><span class="o">=</span>TCP<span class="o">)(</span><span class="nv">HOST</span><span class="o">=</span>bd.oracle.celia.es<span class="o">)(</span><span class="nv">PORT</span><span class="o">=</span>1521<span class="o">)))</span>
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR <span class="k">for</span> Linux: Version 19.0.0.0.0 - Production
Start Date                20-APR-2021 13:59:48
Uptime                    <span class="m">0</span> days <span class="m">0</span> hr. <span class="m">0</span> min. <span class="m">0</span> sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora
Listener Log File         /opt/oracle/diag/tnslsnr/bd/listener/alert/log.xml
Listening Endpoints Summary...
  <span class="o">(</span><span class="nv">DESCRIPTION</span><span class="o">=(</span><span class="nv">ADDRESS</span><span class="o">=(</span><span class="nv">PROTOCOL</span><span class="o">=</span>tcp<span class="o">)(</span><span class="nv">HOST</span><span class="o">=</span>bd.oracle.celia.es<span class="o">)(</span><span class="nv">PORT</span><span class="o">=</span>1521<span class="o">)))</span>
  <span class="o">(</span><span class="nv">DESCRIPTION</span><span class="o">=(</span><span class="nv">ADDRESS</span><span class="o">=(</span><span class="nv">PROTOCOL</span><span class="o">=</span>ipc<span class="o">)(</span><span class="nv">KEY</span><span class="o">=</span>EXTPROC1521<span class="o">)))</span>
Services Summary...
Service <span class="s2">&#34;PSQLU&#34;</span> has <span class="m">1</span> instance<span class="o">(</span>s<span class="o">)</span>.
  Instance <span class="s2">&#34;PSQLU&#34;</span>, status UNKNOWN, has <span class="m">1</span> handler<span class="o">(</span>s<span class="o">)</span> <span class="k">for</span> this service...
The <span class="nb">command</span> completed successfully
</code></pre></div><p>Comprobamos que está escuchando en el puerto indicado.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>oracle@bd ~<span class="o">]</span>$ netstat -tlpn
<span class="o">(</span>Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.<span class="o">)</span>
Active Internet connections <span class="o">(</span>only servers<span class="o">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:111             0.0.0.0:*               LISTEN      -                   
tcp        <span class="m">0</span>      <span class="m">0</span> 192.168.122.1:53        0.0.0.0:*               LISTEN      -                   
tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:631           0.0.0.0:*               LISTEN      -                   
tcp6       <span class="m">0</span>      <span class="m">0</span> :::29443                :::*                    LISTEN      2950/ora_d000_ORCLC 
tcp6       <span class="m">0</span>      <span class="m">0</span> :::111                  :::*                    LISTEN      -                   
tcp6       <span class="m">0</span>      <span class="m">0</span> :::1521                 :::*                    LISTEN      5731/tnslsnr        
tcp6       <span class="m">0</span>      <span class="m">0</span> :::22                   :::*                    LISTEN      -                   
tcp6       <span class="m">0</span>      <span class="m">0</span> ::1:631                 :::*                    LISTEN      -         
</code></pre></div><h3 id="configuracion-servidor-postgresql">Configuracion Servidor postgresql</h3>
<p>Los siguientes ficheros tienen que tener el siguiente contenido, como hemos hecho en el primer apartado de enlace <em>postgresql-postgresql</em></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">nano /etc/postgresql/11/main/postgresql.conf 

. . . 
<span class="nv">listen_addresses</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
. . . 

nano /etc/postgresql/11/main/pg_hba.conf 

. . . 
host all all 0.0.0.0/0 md5
. . . 
</code></pre></div><p>Reiniciamos el servicio de postgresql y creamos el enlace con oracle.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">systemctl restart postgresql
</code></pre></div><h3 id="crear-el-enlace">Crear el enlace</h3>
<p>Desde el servidor de <strong>oracle</strong> creamos el link para postgresql de esta forma</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sqlplus / as sysdba
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">SQL&gt; create public database link psql1 connect to <span class="s2">&#34;celia&#34;</span> identified by <span class="s2">&#34;celia&#34;</span> using <span class="s1">&#39;PSQLU&#39;</span><span class="p">;</span>

Enlace con la base de datos creado.

</code></pre></div><p>Una vez creado el enlace vamos a realizar una consulta a postgresql</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">SQL&gt; connect c##celia/celia
Conectado.

SQL&gt; <span class="k">select</span> <span class="s2">&#34;dnombre&#34;</span> from <span class="s2">&#34;departamento&#34;</span>@psql1<span class="p">;</span>                     

dnombre
--------------------------------------------------------------------------------
CONTABILIDAD
INVESTIGACION
VENTAS
PRODUCCION

SQL&gt; <span class="k">select</span> <span class="s2">&#34;dnombre&#34;</span> , <span class="s2">&#34;dept_no&#34;</span> from <span class="s2">&#34;departamento&#34;</span>@psql1<span class="p">;</span>     

dnombre
--------------------------------------------------------------------------------
   dept_no
----------
CONTABILIDAD
	<span class="m">10</span>

INVESTIGACION
	<span class="m">20</span>

VENTAS
	<span class="m">30</span>


dnombre
--------------------------------------------------------------------------------
   dept_no
----------
PRODUCCION
	<span class="m">40</span>

</code></pre></div><p>Ademas también podemos hacer <em>joins</em>. Para ello vamos a crear la tabla empleados en la base de datos oracle y haremos una consulta de ambas tablas en diferentes gestores.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">CREATE TABLE empleados <span class="o">(</span>dni VARCHAR2<span class="o">(</span>4<span class="o">)</span>,nombre VARCHAR2<span class="o">(</span>10<span class="o">)</span>, depart VARCHAR2<span class="o">(</span>3<span class="o">)</span>, CONSTRAINT pk_empleados PRIMARY KEY <span class="o">(</span>dni<span class="o">))</span><span class="p">;</span>

INSERT INTO empleados <span class="o">(</span>dni, nombre, depart<span class="o">)</span> VALUES<span class="o">(</span><span class="s1">&#39;1111&#39;</span>,<span class="s1">&#39;Carlos&#39;</span>,<span class="s1">&#39;40&#39;</span><span class="o">)</span><span class="p">;</span>
INSERT INTO empleados <span class="o">(</span>dni, nombre, depart<span class="o">)</span> VALUES<span class="o">(</span><span class="s1">&#39;2222&#39;</span>,<span class="s1">&#39;Celia&#39;</span>,<span class="s1">&#39;40&#39;</span><span class="o">)</span><span class="p">;</span>
INSERT INTO empleados <span class="o">(</span>dni, nombre, depart<span class="o">)</span> VALUES<span class="o">(</span><span class="s1">&#39;3333&#39;</span>,<span class="s1">&#39;Lucía&#39;</span>,<span class="s1">&#39;20&#39;</span><span class="o">)</span><span class="p">;</span>
</code></pre></div><p>Comprobamos que se ha creado:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">SQL&gt; <span class="k">select</span> * from empleados<span class="p">;</span>

DNI  NOMBRE	DEP
---- ---------- ---
<span class="m">1111</span> Carlos	<span class="m">40</span>
<span class="m">2222</span> Celia	<span class="m">40</span>
<span class="m">3333</span> Luc??a	<span class="m">20</span>

</code></pre></div><h3 id="funcionamiento-del-enlace-oracle-postgresql">Funcionamiento del enlace oracle-postgresql</h3>
<p>Ahora vamos hacer la siguiente consulta, que es un join de las dos tablas cada una ubicada en un gestor diferente, siendo <strong>empleados</strong> en la de oracle y <strong>departamentos</strong> en la de postgres.</p>
<p>La consulta consiste en sacar los nombres de los empleados y la localización a la que pertenecen según el departamento.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">
SQL&gt; <span class="k">select</span> a.nombre, b.<span class="s2">&#34;loc&#34;</span> from empleados a, <span class="s2">&#34;departamento&#34;</span>@psql1 b where a.depart <span class="o">=</span> b.<span class="s2">&#34;dept_no&#34;</span><span class="p">;</span>

NOMBRE
----------
loc
--------------------------------------------------------------------------------
Luc??a
MADRID

Carlos
BILBAO

Celia
BILBAO

</code></pre></div><h2 id="enlace-servidor-oracle---servidor-oracle">Enlace Servidor Oracle - Servidor Oracle</h2>
<h3 id="configuración-servidor-oracle-1">Configuración Servidor ORACLE 1</h3>
<p>En la primera máquina con oracle vamos a configurarla de la siguiente manera editando los ficheros que expongo a continuación.</p>
<p><code>nano /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora</code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># listener.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora</span>
<span class="c1"># Generated by Oracle configuration tools.</span>

<span class="nv">LISTENER</span> <span class="o">=</span>
  <span class="o">(</span><span class="nv">DESCRIPTION_LIST</span> <span class="o">=</span>
    <span class="o">(</span><span class="nv">DESCRIPTION</span> <span class="o">=</span>
      <span class="o">(</span><span class="nv">ADDRESS</span> <span class="o">=</span> <span class="o">(</span><span class="nv">PROTOCOL</span> <span class="o">=</span> TCP<span class="o">)(</span><span class="nv">HOST</span> <span class="o">=</span> 0.0.0.0<span class="o">)(</span><span class="nv">PORT</span> <span class="o">=</span> 1521<span class="o">))</span>
      <span class="o">(</span><span class="nv">ADDRESS</span> <span class="o">=</span> <span class="o">(</span><span class="nv">PROTOCOL</span> <span class="o">=</span> IPC<span class="o">)(</span><span class="nv">KEY</span> <span class="o">=</span> EXTPROC1521<span class="o">))</span>
    <span class="o">)</span>
  <span class="o">)</span>

<span class="c1">#SID_LIST_LISTENER=</span>
<span class="c1"># (SID_LIST=</span>
<span class="c1"># (SID_DESC=</span>
<span class="c1"># (SID_NAME=PSQLU)</span>
<span class="c1"># (ORACLE_HOME=/opt/oracle/product/19c/dbhome_1)</span>
<span class="c1"># (PROGRAM=dg4odbc)</span>
<span class="c1"># )</span>
<span class="c1"># )</span>

</code></pre></div><p>Editamos el siguiente fichero donde ahora vamos a indicar el segundo servidor oracle, especificamos la dirección del mismo y el nombre de la base de datos (que en este caso se llama igual porque es una clonación del primer servidor.)</p>
<p><code>nano /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora</code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># tnsnames.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora</span>
<span class="c1"># Generated by Oracle configuration tools.</span>

<span class="nv">ORCLCDB</span> <span class="o">=</span>
  <span class="o">(</span><span class="nv">DESCRIPTION</span> <span class="o">=</span>
    <span class="o">(</span><span class="nv">ADDRESS</span> <span class="o">=</span> <span class="o">(</span><span class="nv">PROTOCOL</span> <span class="o">=</span> TCP<span class="o">)(</span><span class="nv">HOST</span> <span class="o">=</span> localhost<span class="o">)(</span><span class="nv">PORT</span> <span class="o">=</span> 1521<span class="o">))</span>
    <span class="o">(</span><span class="nv">CONNECT_DATA</span> <span class="o">=</span>
      <span class="o">(</span><span class="nv">SERVER</span> <span class="o">=</span> DEDICATED<span class="o">)</span>
      <span class="o">(</span><span class="nv">SERVICE_NAME</span> <span class="o">=</span> ORCLCDB<span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>

<span class="nv">LISTENER_ORCLCDB</span> <span class="o">=</span>
  <span class="o">(</span><span class="nv">ADDRESS</span> <span class="o">=</span> <span class="o">(</span><span class="nv">PROTOCOL</span> <span class="o">=</span> TCP<span class="o">)(</span><span class="nv">HOST</span> <span class="o">=</span> localhost<span class="o">)(</span><span class="nv">PORT</span> <span class="o">=</span> 1521<span class="o">))</span>


<span class="c1"># Segundo servidor oracle</span>
<span class="nv">ORCL2</span> <span class="o">=</span>
 <span class="o">(</span><span class="nv">DESCRIPTION</span> <span class="o">=</span>
 <span class="o">(</span><span class="nv">ADDRESS</span> <span class="o">=</span> <span class="o">(</span><span class="nv">PROTOCOL</span> <span class="o">=</span> TCP<span class="o">)(</span><span class="nv">HOST</span> <span class="o">=</span> 192.168.100.186<span class="o">)(</span><span class="nv">PORT</span> <span class="o">=</span> 1521<span class="o">))</span>
 <span class="o">(</span><span class="nv">CONNECT_DATA</span> <span class="o">=</span>
 <span class="o">(</span><span class="nv">SERVER</span> <span class="o">=</span> DEDICATED<span class="o">)</span>
 <span class="o">(</span><span class="nv">SERVICE_NAME</span> <span class="o">=</span> ORCLCDB<span class="o">)</span>
 <span class="o">)</span>
 <span class="o">)</span>

<span class="c1"># para postgresql</span>
<span class="c1">#PSQLU =</span>
<span class="c1"># (DESCRIPTION=</span>
<span class="c1"># (ADDRESS=(PROTOCOL=tcp)(HOST=localhost)(PORT=1521))</span>
<span class="c1"># (CONNECT_DATA=(SID=PSQLU))</span>
<span class="c1"># (HS=OK)</span>
<span class="c1"># )</span>


</code></pre></div><p>Una vez cambiada la configuración paramos el listener y lo volvemos a iniciar.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">lsnrctl stop
lsnrctl start
</code></pre></div><h3 id="configuración-servidor-oracle-2">Configuración Servidor ORACLE 2</h3>
<p>En la segunda máquina oracle vamos a cambiar también la configuración de la siguiente forma.</p>
<p><code>nano /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora </code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># listener.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora</span>
<span class="c1"># Generated by Oracle configuration tools.</span>

<span class="nv">LISTENER</span> <span class="o">=</span>
  <span class="o">(</span><span class="nv">DESCRIPTION_LIST</span> <span class="o">=</span>
    <span class="o">(</span><span class="nv">DESCRIPTION</span> <span class="o">=</span>
      <span class="o">(</span><span class="nv">ADDRESS</span> <span class="o">=</span> <span class="o">(</span><span class="nv">PROTOCOL</span> <span class="o">=</span> TCP<span class="o">)(</span><span class="nv">HOST</span> <span class="o">=</span> 0.0.0.0<span class="o">)(</span><span class="nv">PORT</span> <span class="o">=</span> 1521<span class="o">))</span>
      <span class="o">(</span><span class="nv">ADDRESS</span> <span class="o">=</span> <span class="o">(</span><span class="nv">PROTOCOL</span> <span class="o">=</span> IPC<span class="o">)(</span><span class="nv">KEY</span> <span class="o">=</span> EXTPROC1521<span class="o">))</span>
    <span class="o">)</span>
  <span class="o">)</span>


</code></pre></div><p>Ahora reiniciamos el servicio como hemos hecho anteriormente</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">lsnrctl stop
lsnrctl start
</code></pre></div><h2 id="crear-enlace-desde-el-primer-servidor-de-oracle">Crear enlace desde el primer servidor de oracle</h2>
<p>Nos conectamos como administrador y creamos el enlace.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>oracle@bd ~<span class="o">]</span>$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Tue Apr <span class="m">20</span> 16:15:45 <span class="m">2021</span>
Version 19.3.0.0.0

Copyright <span class="o">(</span>c<span class="o">)</span> 1982, 2019, Oracle.  All rights reserved.


Conectado a:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0

SQL&gt; create database link oracle1
  <span class="m">2</span>  connect to c##celia
  <span class="m">3</span>  identified by celia
  <span class="m">4</span>  using <span class="s1">&#39;orcl2&#39;</span><span class="p">;</span>

Enlace con la base de datos creado.

</code></pre></div><p>Primero probaremos que podemos acceder al otro servidor con el siguiente comando</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>oracle@bd ~<span class="o">]</span>$ sql c##celia/celia@192.168.100.186/orclcdb

SQLcl: Versión 19.1 Production en mar abr <span class="m">20</span> 16:33:32 <span class="m">2021</span>

Copyright <span class="o">(</span>c<span class="o">)</span> 1982, 2021, Oracle. Todos los derechos reservados.

Conectado a:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0


SQL&gt; <span class="k">select</span> * from alumnos<span class="p">;</span>

DNI             NOMBRE    
--------------- ----------
<span class="m">1111</span>            Carlos    
<span class="m">2222</span>            Celia     
<span class="m">3333</span>            Luc��a    

</code></pre></div><p>Efectivamente tenemos conexión. Ahora vamos hacer las consultas.</p>
<h2 id="funcionamiento">Funcionamiento</h2>
<p>Nos logueamos como admistrador y hacemos la consulta de esta forma:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">SQL&gt; <span class="k">select</span> * from cat@oracle1<span class="p">;</span>

TABLE_NAME
--------------------------------------------------------------------------------
TABLE_TYPE
-----------
ALUMNOS
TABLE

CURSOS
TABLE

MATRICULAS
TABLE

</code></pre></div><p>También podemos hacer joins de dos tablas en ambos servidores.</p>
<p>Eliminamos las tablas matriculas y cursos y las ubicamos en el primer servidor</p>
<p><strong>Quiero saber a qué curso va cada niño con un JOIN.</strong></p>
<p>Siendo:</p>
<ul>
<li>tabla alumnos (servidor oracle 2)</li>
<li>tablas cursos y matriculas (servidor oracle 1)</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="k">select</span> distinct a.nombre, c.nombrecurso as curso from alumnos@oracle1 a, matriculas b, cursos c where a.dni <span class="o">=</span> b.dni and b.codigocurso <span class="o">=</span> c.codigocurso<span class="p">;</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">SQL&gt; <span class="k">select</span> distinct a.nombre, c.nombrecurso as curso from alumnos@oracle1 a, matriculas b, cursos c where a.dni <span class="o">=</span> b.dni and b.codigocurso <span class="o">=</span> c.codigocurso<span class="p">;</span>

NOMBRE	   CURSO
---------- -----
Celia	   <span class="m">2</span>
Luc??a	   <span class="m">3</span>
Carlos	   <span class="m">1</span>


</code></pre></div></div>
        <div class="post-footer">
            <div class="info">
                
                <span class="separator"><a class="tag" href="/tags/interconexiones-bbdd/">interconexiones bbdd</a></span>

            </div>
        </div>

        
    </div>


        </div>
    </div>
</div>

<script type="text/javascript"
        src="https://www.celiagm.es/js/medium-zoom.min.92f21c856129f84aeb719459b3e6ac621a3032fd7b180a18c04e1d12083f8aba.js"
        integrity="sha256-kvIchWEp&#43;ErrcZRZs&#43;asYhowMv17GAoYwE4dEgg/iro="
        crossorigin="anonymous"></script></body>

</html>
